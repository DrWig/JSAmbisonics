"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.forwardSHT = forwardSHT;
exports.inverseSHT = inverseSHT;
exports.print2Darray = print2Darray;
exports.convertCart2Sph = convertCart2Sph;
exports.convertSph2Cart = convertSph2Cart;
exports.computeRealSH = computeRealSH;
exports.factorial = factorial;
exports.recurseLegendrePoly = recurseLegendrePoly;
exports.pinv_svd = pinv_svd;
exports.pinv_direct = pinv_direct;
exports.getSHrotMtx = getSHrotMtx;
exports.U = U;
exports.V = V;
exports.W = W;
exports.P = P;
exports.yawPitchRoll2Rzyx = yawPitchRoll2Rzyx;

var _numeric = require("./numeric-1.2.6.min");

var numeric = _interopRequireWildcard(_numeric);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

// forwardSHT implements the forward SHT on data defined over the sphere
function forwardSHT(N, data, CART_OR_SPH, DIRECT_OR_PINV) {

    var Ndirs = data.length,
        Nsh = (N + 1) * (N + 1);
    var invY_N;
    var mag = [,];
    if (Nsh > Ndirs) {
        console.log("The SHT degree is too high for the number of data points");
    }

    // Convert cartesian to spherical if needed
    if (CART_OR_SPH == 0) data = convertCart2Sph(data);
    for (var i = 0; i < data.length; i++) {
        mag[i] = data[i][0];
    }
    // SH sampling matrix
    Y_N = computeRealSH(N, data);
    // Direct SHT
    if (DIRECT_OR_PINV == 0) {
        invY_N = numeric.mul(1 / Ndirs, Y_N);
    } else {
        invY_N = pinv_direct(numeric.transpose(Y_N));
    }
    // Perform SHT
    var coeffs = numeric.dotMV(invY_N, mag);
    return coeffs;
}

// inverseSHT implements the inverse SHT from SH coefficients
////////////////////////////////////////////////////////////////////
//  Archontis Politis
//  archontis.politis@aalto.fi
////////////////////////////////////////////////////////////////////
//
//  JSHlib a JavaScript library that implements
//  the spherical harmonic transform for real spherical harmonics
//  and some useful transformations in the spherical harmonic domain
//
//  The library uses the numeric.js library for matrix operations
//  http://www.numericjs.com/
//
////////////////////////////////////////////////////////////////////

function inverseSHT(coeffs, aziElev) {

    var aziElevR = aziElev;
    var N = Math.sqrt(coeffs.length) - 1;
    // SH sampling matrix
    var Y_N = computeRealSH(N, aziElev);
    // reconstruction
    var data = numeric.dotVM(coeffs, Y_N);
    // gather in data matrix
    for (var i = 0; i < aziElev.length; i++) {
        aziElevR[i][2] = data[i];
    }
    return aziElevR;
}

// xxxxxxxxxxxxxxxxxx
function print2Darray(array2D) {
    for (var q = 0; q < array2D.length; q++) {
        console.log(array2D[q]);
    }
}

// convertCart2Sph converts arrays of cartesian vectors to spherical coordinates
function convertCart2Sph(xyz, OMIT_MAG) {

    var azi, elev, r;
    var aziElevR = new Array(xyz.length);

    for (var i = 0; i < xyz.length; i++) {
        azi = Math.atan2(xyz[i][1], xyz[i][0]);
        elev = Math.atan2(xyz[i][2], Math.sqrt(xyz[i][0] * xyz[i][0] + xyz[i][1] * xyz[i][1]));
        if (OMIT_MAG == 1) {
            aziElevR[i] = [azi, elev];
        } else {
            r = Math.sqrt(xyz[i][0] * xyz[i][0] + xyz[i][1] * xyz[i][1] + xyz[i][2] * xyz[i][2]);
            aziElevR[i] = [azi, elev, r];
        }
    }
    return aziElevR;
}

// convertSph2Cart converts arrays of spherical coordinates to cartesian
function convertSph2Cart(aziElevR) {

    var x, y, z;
    var xyz = new Array(aziElevR.length);

    for (var i = 0; i < aziElevR.length; i++) {
        x = Math.cos(aziElevR[i][0]) * Math.cos(aziElevR[i][1]);
        y = Math.sin(aziElevR[i][0]) * Math.cos(aziElevR[i][1]);
        z = Math.sin(aziElevR[i][1]);
        if (aziElevR[0].length == 2) xyz[i] = [x, y, z];else if (aziElevR[0].length == 3) xyz[i] = [aziElevR[i][2] * x, aziElevR[i][2] * y, aziElevR[i][2] * z];
    }
    return xyz;
}

// computeRealSH computes real spherical harmonics up to order N
function computeRealSH(N, data) {

    var azi = new Array(data.length);
    var elev = new Array(data.length);

    for (var i = 0; i < data.length; i++) {
        azi[i] = data[i][0];
        elev[i] = data[i][1];
    }

    var factorials = new Array(2 * N + 1);
    var Ndirs = azi.length;
    var Nsh = (N + 1) * (N + 1);
    var leg_n_minus1 = 0;
    var leg_n_minus2 = 0;
    var leg_n;
    var sinel = numeric.sin(elev);
    var index_n = 0;
    var Y_N = new Array(Nsh);
    var Nn0, Nnm;
    var cosmazi, sinmazi;

    // precompute factorials
    for (var i = 0; i < 2 * N + 1; i++) {
        factorials[i] = factorial(i);
    }for (var n = 0; n < N + 1; n++) {
        if (n == 0) {
            var temp0 = new Array(azi.length);
            temp0.fill(1);
            Y_N[n] = temp0;
            index_n = 1;
        } else {
            leg_n = recurseLegendrePoly(n, sinel, leg_n_minus1, leg_n_minus2);
            Nn0 = Math.sqrt(2 * n + 1);
            for (var m = 0; m < n + 1; m++) {
                if (m == 0) Y_N[index_n + n] = numeric.mul(Nn0, leg_n[m]);else {
                    Nnm = Nn0 * Math.sqrt(2 * factorials[n - m] / factorials[n + m]);
                    cosmazi = numeric.cos(numeric.mul(m, azi));
                    sinmazi = numeric.sin(numeric.mul(m, azi));
                    Y_N[index_n + n - m] = numeric.mul(Nnm, numeric.mul(leg_n[m], sinmazi));
                    Y_N[index_n + n + m] = numeric.mul(Nnm, numeric.mul(leg_n[m], cosmazi));
                }
            }
            index_n = index_n + 2 * n + 1;
        }
        leg_n_minus2 = leg_n_minus1;
        leg_n_minus1 = leg_n;
    }

    return Y_N;
}

// factorial compute factorial
function factorial(n) {
    if (n === 0) return 1;
    return n * factorial(n - 1);
}

// recurseLegendrePoly computes associated Legendre functions recursively
function recurseLegendrePoly(n, x, Pnm_minus1, Pnm_minus2) {

    var Pnm = new Array(n + 1);
    switch (n) {
        case 1:
            var x2 = numeric.mul(x, x);
            var P10 = x;
            var P11 = numeric.sqrt(numeric.sub(1, x2));
            Pnm[0] = P10;
            Pnm[1] = P11;
            break;
        case 2:
            var x2 = numeric.mul(x, x);
            var P20 = numeric.mul(3, x2);
            P20 = numeric.sub(P20, 1);
            P20 = numeric.div(P20, 2);
            var P21 = numeric.sub(1, x2);
            P21 = numeric.sqrt(P21);
            P21 = numeric.mul(3, P21);
            P21 = numeric.mul(P21, x);
            var P22 = numeric.sub(1, x2);
            P22 = numeric.mul(3, P22);
            Pnm[0] = P20;
            Pnm[1] = P21;
            Pnm[2] = P22;
            break;
        default:
            var x2 = numeric.mul(x, x);
            var one_min_x2 = numeric.sub(1, x2);
            // last term m=n
            var k = 2 * n - 1;
            var dfact_k = 1;
            if (k % 2 == 0) {
                for (var kk = 1; kk < k / 2 + 1; kk++) {
                    dfact_k = dfact_k * 2 * kk;
                }
            } else {
                for (var kk = 1; kk < (k + 1) / 2 + 1; kk++) {
                    dfact_k = dfact_k * (2 * kk - 1);
                }
            }
            Pnm[n] = numeric.mul(dfact_k, numeric.pow(one_min_x2, n / 2));
            // before last term
            Pnm[n - 1] = numeric.mul(2 * n - 1, numeric.mul(x, Pnm_minus1[n - 1])); // P_{n(n-1)} = (2*n-1)*x*P_{(n-1)(n-1)}
            // three term recursence for the rest
            for (var m = 0; m < n - 1; m++) {
                var temp1 = numeric.mul(2 * n - 1, numeric.mul(x, Pnm_minus1[m]));
                var temp2 = numeric.mul(n + m - 1, Pnm_minus2[m]);
                Pnm[m] = numeric.div(numeric.sub(temp1, temp2), n - m); // P_l = ( (2l-1)xP_(l-1) - (l+m-1)P_(l-2) )/(l-m)
            }
    }
    return Pnm;
}

// pinv_svd computes the pseudo-inverse using SVD
function pinv_svd(A) {
    var z = numeric.svd(A),
        foo = z.S[0];
    var U = z.U,
        S = z.S,
        V = z.V;
    var m = A.length,
        n = A[0].length,
        tol = Math.max(m, n) * numeric.epsilon * foo,
        M = S.length;
    var Sinv = new Array(M);
    for (var i = M - 1; i !== -1; i--) {
        if (S[i] > tol) Sinv[i] = 1 / S[i];else Sinv[i] = 0;
    }
    return numeric.dot(numeric.dot(V, numeric.diag(Sinv)), numeric.transpose(U));
}

// pinv_svd computes the left pseudo-inverse
function pinv_direct(A) {
    var AT = numeric.transpose(A);
    return numeric.dot(numeric.inv(numeric.dot(AT, A)), AT);
}

// computes rotation matrices for real spherical harmonics
function getSHrotMtx(Rxyz, L) {

    var Nsh = (L + 1) * (L + 1);
    // allocate total rotation matrix
    var R = numeric.rep([Nsh, Nsh], 0);

    // initialize zeroth and first band rotation matrices for recursion
    // Rxyz = [Rxx Rxy Rxz
    //         Ryx Ryy Ryz
    //         Rzx Rzy Rzz]
    //
    // zeroth-band (l=0) is invariant to rotation
    R[0][0] = 1;

    // the first band (l=1) is directly related to the rotation matrix
    var R_1 = numeric.rep([3, 3], 0);
    R_1[0][0] = Rxyz[1][1];
    R_1[0][1] = Rxyz[1][2];
    R_1[0][2] = Rxyz[1][0];
    R_1[1][0] = Rxyz[2][1];
    R_1[1][1] = Rxyz[2][2];
    R_1[1][2] = Rxyz[2][0];
    R_1[2][0] = Rxyz[0][1];
    R_1[2][1] = Rxyz[0][2];
    R_1[2][2] = Rxyz[0][0];

    R = numeric.setBlock(R, [1, 1], [3, 3], R_1);
    var R_lm1 = R_1;

    // compute rotation matrix of each subsequent band recursively
    var band_idx = 3;
    for (var l = 2; l < L + 1; l++) {

        var R_l = numeric.rep([2 * l + 1, 2 * l + 1], 0);
        for (var m = -l; m < l + 1; m++) {
            for (var n = -l; n < l + 1; n++) {
                // compute u,v,w terms of Eq.8.1 (Table I)
                var d, denom, u, v, w;
                if (m == 0) d = 1;else d = 0; // the delta function d_m0
                if (Math.abs(n) == l) denom = 2 * l * (2 * l - 1);else denom = l * l - n * n;

                u = Math.sqrt((l * l - m * m) / denom);
                v = Math.sqrt((1 + d) * (l + Math.abs(m) - 1) * (l + Math.abs(m)) / denom) * (1 - 2 * d) * 0.5;
                w = Math.sqrt((l - Math.abs(m) - 1) * (l - Math.abs(m)) / denom) * (1 - d) * -0.5;

                // computes Eq.8.1
                if (u != 0) u = u * U(l, m, n, R_1, R_lm1);
                if (v != 0) v = v * V(l, m, n, R_1, R_lm1);
                if (w != 0) w = w * W(l, m, n, R_1, R_lm1);
                R_l[m + l][n + l] = u + v + w;
            }
        }
        R = numeric.setBlock(R, [band_idx + 1, band_idx + 1], [band_idx + 2 * l + 1, band_idx + 2 * l + 1], R_l);
        R_lm1 = R_l;
        band_idx = band_idx + 2 * l + 1;
    }
    return R;
}

// functions to compute terms U, V, W of Eq.8.1 (Table II)
function U(l, m, n, R_1, R_lm1) {

    return P(0, l, m, n, R_1, R_lm1);
}

function V(l, m, n, R_1, R_lm1) {

    var p0, p1, ret, d;
    if (m == 0) {
        p0 = P(1, l, 1, n, R_1, R_lm1);
        p1 = P(-1, l, -1, n, R_1, R_lm1);
        ret = p0 + p1;
    } else if (m > 0) {
        if (m == 1) d = 1;else d = 0;
        p0 = P(1, l, m - 1, n, R_1, R_lm1);
        p1 = P(-1, l, -m + 1, n, R_1, R_lm1);
        ret = p0 * Math.sqrt(1 + d) - p1 * (1 - d);
    } else {
        if (m == -1) d = 1;else d = 0;
        p0 = P(1, l, m + 1, n, R_1, R_lm1);
        p1 = P(-1, l, -m - 1, n, R_1, R_lm1);
        ret = p0 * (1 - d) + p1 * Math.sqrt(1 + d);
    }
    return ret;
}

function W(l, m, n, R_1, R_lm1) {

    var p0, p1, ret;
    if (m == 0) {
        console.error("should not be called");
    } else {
        if (m > 0) {
            p0 = P(1, l, m + 1, n, R_1, R_lm1);
            p1 = P(-1, l, -m - 1, n, R_1, R_lm1);
            ret = p0 + p1;
        } else {
            p0 = P(1, l, m - 1, n, R_1, R_lm1);
            p1 = P(-1, l, -m + 1, n, R_1, R_lm1);
            ret = p0 - p1;
        }
    }
    return ret;
}

// function to compute term P of U,V,W (Table II)
function P(i, l, a, b, R_1, R_lm1) {

    var ri1, rim1, ri0, ret;
    ri1 = R_1[i + 1][1 + 1];
    rim1 = R_1[i + 1][-1 + 1];
    ri0 = R_1[i + 1][0 + 1];

    if (b == -l) {
        ret = ri1 * R_lm1[a + l - 1][0] + rim1 * R_lm1[a + l - 1][2 * l - 2];
    } else {
        if (b == l) ret = ri1 * R_lm1[a + l - 1][2 * l - 2] - rim1 * R_lm1[a + l - 1][0];else ret = ri0 * R_lm1[a + l - 1][b + l - 1];
    }
    return ret;
}

// yawPitchRoll2Rzyx computes the rotation matrix from ZY'X'' rotation angles
function yawPitchRoll2Rzyx(yaw, pitch, roll) {

    var Rx = void 0,
        Ry = void 0,
        Rz = void 0;
    if (roll == 0) Rx = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];else Rx = [[1, 0, 0], [0, Math.cos(roll), Math.sin(roll)], [0, -Math.sin(roll), Math.cos(roll)]];
    if (pitch == 0) Ry = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];else Ry = [[Math.cos(pitch), 0, -Math.sin(pitch)], [0, 1, 0], [Math.sin(pitch), 0, Math.cos(pitch)]];
    if (yaw == 0) Rz = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];else Rz = [[Math.cos(yaw), Math.sin(yaw), 0], [-Math.sin(yaw), Math.cos(yaw), 0], [0, 0, 1]];

    var R = numeric.dotMMsmall(Ry, Rz);
    R = numeric.dotMMsmall(Rx, R);
    return R;
}
//# sourceMappingURL=data:application/json;base64,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Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gIEFyY2hvbnRpcyBQb2xpdGlzXG4vLyAgYXJjaG9udGlzLnBvbGl0aXNAYWFsdG8uZmlcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vL1xuLy8gIEpTSGxpYiBhIEphdmFTY3JpcHQgbGlicmFyeSB0aGF0IGltcGxlbWVudHNcbi8vICB0aGUgc3BoZXJpY2FsIGhhcm1vbmljIHRyYW5zZm9ybSBmb3IgcmVhbCBzcGhlcmljYWwgaGFybW9uaWNzXG4vLyAgYW5kIHNvbWUgdXNlZnVsIHRyYW5zZm9ybWF0aW9ucyBpbiB0aGUgc3BoZXJpY2FsIGhhcm1vbmljIGRvbWFpblxuLy9cbi8vICBUaGUgbGlicmFyeSB1c2VzIHRoZSBudW1lcmljLmpzIGxpYnJhcnkgZm9yIG1hdHJpeCBvcGVyYXRpb25zXG4vLyAgaHR0cDovL3d3dy5udW1lcmljanMuY29tL1xuLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmltcG9ydCAqIGFzIG51bWVyaWMgZnJvbSAnLi9udW1lcmljLTEuMi42Lm1pbidcblxuLy8gZm9yd2FyZFNIVCBpbXBsZW1lbnRzIHRoZSBmb3J3YXJkIFNIVCBvbiBkYXRhIGRlZmluZWQgb3ZlciB0aGUgc3BoZXJlXG5leHBvcnQgZnVuY3Rpb24gZm9yd2FyZFNIVChOLCBkYXRhLCBDQVJUX09SX1NQSCwgRElSRUNUX09SX1BJTlYpIHtcblxuICAgIHZhciBOZGlycyA9IGRhdGEubGVuZ3RoLCBOc2ggPSAoTisxKSooTisxKTtcbiAgICB2YXIgaW52WV9OO1xuICAgIHZhciBtYWcgPSBbLF07XG4gICAgaWYgKE5zaD5OZGlycykgIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUaGUgU0hUIGRlZ3JlZSBpcyB0b28gaGlnaCBmb3IgdGhlIG51bWJlciBvZiBkYXRhIHBvaW50c1wiKVxuICAgIH1cblxuICAgIC8vIENvbnZlcnQgY2FydGVzaWFuIHRvIHNwaGVyaWNhbCBpZiBuZWVkZWRcbiAgICBpZiAoQ0FSVF9PUl9TUEg9PTApIGRhdGEgPSBjb252ZXJ0Q2FydDJTcGgoZGF0YSk7XG4gICAgZm9yICh2YXIgIGk9MDsgaTxkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG1hZ1tpXSA9IGRhdGFbaV1bMF07XG4gICAgfVxuICAgIC8vIFNIIHNhbXBsaW5nIG1hdHJpeFxuICAgIFlfTiA9IGNvbXB1dGVSZWFsU0goTiwgZGF0YSk7XG4gICAgLy8gRGlyZWN0IFNIVFxuICAgIGlmIChESVJFQ1RfT1JfUElOVj09MCkge1xuICAgICAgICBpbnZZX04gPSBudW1lcmljLm11bCgxL05kaXJzLFlfTik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpbnZZX04gPSBwaW52X2RpcmVjdChudW1lcmljLnRyYW5zcG9zZShZX04pKTtcbiAgICB9XG4gICAgLy8gUGVyZm9ybSBTSFRcbiAgICB2YXIgY29lZmZzID0gbnVtZXJpYy5kb3RNVihpbnZZX04sIG1hZyk7XG4gICAgcmV0dXJuIGNvZWZmcztcbn1cblxuLy8gaW52ZXJzZVNIVCBpbXBsZW1lbnRzIHRoZSBpbnZlcnNlIFNIVCBmcm9tIFNIIGNvZWZmaWNpZW50c1xuZXhwb3J0IGZ1bmN0aW9uIGludmVyc2VTSFQoY29lZmZzLCBhemlFbGV2KSB7XG5cbiAgICB2YXIgYXppRWxldlIgPSBhemlFbGV2O1xuICAgIHZhciBOID0gTWF0aC5zcXJ0KGNvZWZmcy5sZW5ndGgpLTE7XG4gICAgLy8gU0ggc2FtcGxpbmcgbWF0cml4XG4gICAgdmFyIFlfTiA9IGNvbXB1dGVSZWFsU0goTiwgYXppRWxldik7XG4gICAgLy8gcmVjb25zdHJ1Y3Rpb25cbiAgICB2YXIgZGF0YSA9IG51bWVyaWMuZG90Vk0oY29lZmZzLCBZX04pO1xuICAgIC8vIGdhdGhlciBpbiBkYXRhIG1hdHJpeFxuICAgIGZvciAodmFyIGk9MDsgaTxhemlFbGV2Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGF6aUVsZXZSW2ldWzJdID0gZGF0YVtpXTtcbiAgICB9XG4gICAgcmV0dXJuIGF6aUVsZXZSO1xufVxuXG4vLyB4eHh4eHh4eHh4eHh4eHh4eHhcbmV4cG9ydCBmdW5jdGlvbiBwcmludDJEYXJyYXkoYXJyYXkyRCkge1xuICAgIGZvciAodmFyIHE9MDsgcTxhcnJheTJELmxlbmd0aDsgcSsrKSBjb25zb2xlLmxvZyhhcnJheTJEW3FdKTtcbn1cblxuLy8gY29udmVydENhcnQyU3BoIGNvbnZlcnRzIGFycmF5cyBvZiBjYXJ0ZXNpYW4gdmVjdG9ycyB0byBzcGhlcmljYWwgY29vcmRpbmF0ZXNcbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0Q2FydDJTcGgoeHl6LCBPTUlUX01BRykge1xuXG4gICAgdmFyIGF6aSwgZWxldiwgcjtcbiAgICB2YXIgYXppRWxldlIgPSBuZXcgQXJyYXkoeHl6Lmxlbmd0aCk7XG5cbiAgICBmb3IgKHZhciBpPTA7IGk8eHl6Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGF6aSA9IE1hdGguYXRhbjIoIHh5eltpXVsxXSwgeHl6W2ldWzBdICk7XG4gICAgICAgIGVsZXYgPSBNYXRoLmF0YW4yKCB4eXpbaV1bMl0sIE1hdGguc3FydCh4eXpbaV1bMF0qeHl6W2ldWzBdICsgeHl6W2ldWzFdKnh5eltpXVsxXSkgKTtcbiAgICAgICAgaWYgKE9NSVRfTUFHPT0xKSB7XG4gICAgICAgICAgICBhemlFbGV2UltpXSA9IFthemksZWxldl07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByID0gTWF0aC5zcXJ0KHh5eltpXVswXSp4eXpbaV1bMF0gKyB4eXpbaV1bMV0qeHl6W2ldWzFdICsgeHl6W2ldWzJdKnh5eltpXVsyXSk7XG4gICAgICAgICAgICBhemlFbGV2UltpXSA9IFthemksZWxldixyXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXppRWxldlI7XG59XG5cbi8vIGNvbnZlcnRTcGgyQ2FydCBjb252ZXJ0cyBhcnJheXMgb2Ygc3BoZXJpY2FsIGNvb3JkaW5hdGVzIHRvIGNhcnRlc2lhblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRTcGgyQ2FydChhemlFbGV2Uikge1xuXG4gICAgdmFyIHgseSx6O1xuICAgIHZhciB4eXogPSBuZXcgQXJyYXkoYXppRWxldlIubGVuZ3RoKTtcblxuICAgIGZvciAodmFyIGk9MDsgaTxhemlFbGV2Ui5sZW5ndGg7IGkrKykge1xuICAgICAgICB4ID0gTWF0aC5jb3MoYXppRWxldlJbaV1bMF0pKk1hdGguY29zKGF6aUVsZXZSW2ldWzFdKTtcbiAgICAgICAgeSA9IE1hdGguc2luKGF6aUVsZXZSW2ldWzBdKSpNYXRoLmNvcyhhemlFbGV2UltpXVsxXSk7XG4gICAgICAgIHogPSBNYXRoLnNpbihhemlFbGV2UltpXVsxXSk7XG4gICAgICAgIGlmIChhemlFbGV2UlswXS5sZW5ndGg9PTIpIHh5eltpXSA9IFt4LHksel07XG4gICAgICAgIGVsc2UgaWYgKGF6aUVsZXZSWzBdLmxlbmd0aD09MykgeHl6W2ldID0gW2F6aUVsZXZSW2ldWzJdKngsYXppRWxldlJbaV1bMl0qeSxhemlFbGV2UltpXVsyXSp6XTtcbiAgICB9XG4gICAgcmV0dXJuIHh5ejtcbn1cblxuLy8gY29tcHV0ZVJlYWxTSCBjb21wdXRlcyByZWFsIHNwaGVyaWNhbCBoYXJtb25pY3MgdXAgdG8gb3JkZXIgTlxuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVSZWFsU0goTiwgZGF0YSkge1xuXG4gICAgdmFyIGF6aSA9IG5ldyBBcnJheShkYXRhLmxlbmd0aCk7XG4gICAgdmFyIGVsZXYgPSBuZXcgQXJyYXkoZGF0YS5sZW5ndGgpO1xuXG4gICAgZm9yICh2YXIgaT0wOyBpPGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXppW2ldID0gZGF0YVtpXVswXTtcbiAgICAgICAgZWxldltpXSA9IGRhdGFbaV1bMV07XG4gICAgfVxuXG4gICAgdmFyIGZhY3RvcmlhbHMgPSBuZXcgQXJyYXkoMipOKzEpO1xuICAgIHZhciBOZGlycyA9IGF6aS5sZW5ndGg7XG4gICAgdmFyIE5zaCA9IChOKzEpKihOKzEpO1xuICAgIHZhciBsZWdfbl9taW51czEgPSAwO1xuICAgIHZhciBsZWdfbl9taW51czIgPSAwO1xuICAgIHZhciBsZWdfbjtcbiAgICB2YXIgc2luZWwgPSBudW1lcmljLnNpbihlbGV2KTtcbiAgICB2YXIgaW5kZXhfbiA9IDA7XG4gICAgdmFyIFlfTiA9IG5ldyBBcnJheShOc2gpO1xuICAgIHZhciBObjAsIE5ubTtcbiAgICB2YXIgY29zbWF6aSwgc2lubWF6aTtcblxuICAgIC8vIHByZWNvbXB1dGUgZmFjdG9yaWFsc1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMipOKzE7IGkrKykgZmFjdG9yaWFsc1tpXSA9IGZhY3RvcmlhbChpKTtcblxuICAgIGZvciAodmFyIG4gPSAwOyBuPE4rMTsgbisrKSB7XG4gICAgICAgIGlmIChuPT0wKSB7XG4gICAgICAgICAgICB2YXIgdGVtcDAgPSBuZXcgQXJyYXkoYXppLmxlbmd0aCk7XG4gICAgICAgICAgICB0ZW1wMC5maWxsKDEpO1xuICAgICAgICAgICAgWV9OW25dID0gdGVtcDA7XG4gICAgICAgICAgICBpbmRleF9uID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxlZ19uID0gcmVjdXJzZUxlZ2VuZHJlUG9seShuLCBzaW5lbCwgbGVnX25fbWludXMxLCBsZWdfbl9taW51czIpO1xuICAgICAgICAgICAgTm4wID0gTWF0aC5zcXJ0KDIqbisxKTtcbiAgICAgICAgICAgIGZvciAodmFyIG0gPSAwOyBtPG4rMTsgbSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG09PTApIFlfTltpbmRleF9uK25dID0gbnVtZXJpYy5tdWwoTm4wLGxlZ19uW21dKTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgTm5tID0gTm4wKk1hdGguc3FydCggMiAqIGZhY3RvcmlhbHNbbi1tXS9mYWN0b3JpYWxzW24rbV0gKTtcbiAgICAgICAgICAgICAgICAgICAgY29zbWF6aSA9IG51bWVyaWMuY29zKG51bWVyaWMubXVsKG0sYXppKSk7XG4gICAgICAgICAgICAgICAgICAgIHNpbm1hemkgPSBudW1lcmljLnNpbihudW1lcmljLm11bChtLGF6aSkpO1xuICAgICAgICAgICAgICAgICAgICBZX05baW5kZXhfbituLW1dID0gbnVtZXJpYy5tdWwoTm5tLCBudW1lcmljLm11bChsZWdfblttXSwgc2lubWF6aSkpO1xuICAgICAgICAgICAgICAgICAgICBZX05baW5kZXhfbituK21dID0gbnVtZXJpYy5tdWwoTm5tLCBudW1lcmljLm11bChsZWdfblttXSwgY29zbWF6aSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluZGV4X24gPSBpbmRleF9uKzIqbisxO1xuICAgICAgICB9XG4gICAgICAgIGxlZ19uX21pbnVzMiA9IGxlZ19uX21pbnVzMTtcbiAgICAgICAgbGVnX25fbWludXMxID0gbGVnX247XG4gICAgfVxuXG4gICAgcmV0dXJuIFlfTjtcbn1cblxuLy8gZmFjdG9yaWFsIGNvbXB1dGUgZmFjdG9yaWFsXG5leHBvcnQgZnVuY3Rpb24gZmFjdG9yaWFsKG4pIHtcbiAgICBpZiAobiA9PT0gMCkgcmV0dXJuIDE7XG4gICAgcmV0dXJuIG4gKiBmYWN0b3JpYWwobiAtIDEpO1xufVxuXG4vLyByZWN1cnNlTGVnZW5kcmVQb2x5IGNvbXB1dGVzIGFzc29jaWF0ZWQgTGVnZW5kcmUgZnVuY3Rpb25zIHJlY3Vyc2l2ZWx5XG5leHBvcnQgZnVuY3Rpb24gcmVjdXJzZUxlZ2VuZHJlUG9seShuLCB4LCBQbm1fbWludXMxLCBQbm1fbWludXMyKSB7XG5cbiAgICB2YXIgUG5tID0gbmV3IEFycmF5KG4rMSk7XG4gICAgc3dpdGNoKG4pIHtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgdmFyIHgyID0gbnVtZXJpYy5tdWwoeCx4KTtcbiAgICAgICAgICAgIHZhciBQMTAgPSB4O1xuICAgICAgICAgICAgdmFyIFAxMSA9IG51bWVyaWMuc3FydChudW1lcmljLnN1YigxLHgyKSk7XG4gICAgICAgICAgICBQbm1bMF0gPSBQMTA7XG4gICAgICAgICAgICBQbm1bMV0gPSBQMTE7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgdmFyIHgyID0gbnVtZXJpYy5tdWwoeCx4KTtcbiAgICAgICAgICAgIHZhciBQMjAgPSBudW1lcmljLm11bCgzLHgyKTtcbiAgICAgICAgICAgIFAyMCA9IG51bWVyaWMuc3ViKFAyMCwxKTtcbiAgICAgICAgICAgIFAyMCA9IG51bWVyaWMuZGl2KFAyMCwyKTtcbiAgICAgICAgICAgIHZhciBQMjEgPSBudW1lcmljLnN1YigxLHgyKTtcbiAgICAgICAgICAgIFAyMSA9IG51bWVyaWMuc3FydChQMjEpO1xuICAgICAgICAgICAgUDIxID0gbnVtZXJpYy5tdWwoMyxQMjEpO1xuICAgICAgICAgICAgUDIxID0gbnVtZXJpYy5tdWwoUDIxLHgpO1xuICAgICAgICAgICAgdmFyIFAyMiA9IG51bWVyaWMuc3ViKDEseDIpO1xuICAgICAgICAgICAgUDIyID0gbnVtZXJpYy5tdWwoMyxQMjIpO1xuICAgICAgICAgICAgUG5tWzBdID0gUDIwO1xuICAgICAgICAgICAgUG5tWzFdID0gUDIxO1xuICAgICAgICAgICAgUG5tWzJdID0gUDIyO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB2YXIgeDIgPSBudW1lcmljLm11bCh4LHgpO1xuICAgICAgICAgICAgdmFyIG9uZV9taW5feDIgPSBudW1lcmljLnN1YigxLHgyKTtcbiAgICAgICAgICAgIC8vIGxhc3QgdGVybSBtPW5cbiAgICAgICAgICAgIHZhciBrID0gMipuLTE7XG4gICAgICAgICAgICB2YXIgZGZhY3RfayA9IDE7XG4gICAgICAgICAgICBpZiAoKGsgJSAyKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2s9MTsga2s8ay8yKzE7IGtrKyspIGRmYWN0X2sgPSBkZmFjdF9rKjIqa2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBraz0xOyBrazwoaysxKS8yKzE7IGtrKyspIGRmYWN0X2sgPSBkZmFjdF9rKigyKmtrLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUG5tW25dID0gbnVtZXJpYy5tdWwoZGZhY3RfaywgbnVtZXJpYy5wb3cob25lX21pbl94Miwgbi8yKSk7XG4gICAgICAgICAgICAvLyBiZWZvcmUgbGFzdCB0ZXJtXG4gICAgICAgICAgICBQbm1bbi0xXSA9IG51bWVyaWMubXVsKDIqbi0xLCBudW1lcmljLm11bCh4LCBQbm1fbWludXMxW24tMV0pKTsgLy8gUF97bihuLTEpfSA9ICgyKm4tMSkqeCpQX3sobi0xKShuLTEpfVxuICAgICAgICAgICAgLy8gdGhyZWUgdGVybSByZWN1cnNlbmNlIGZvciB0aGUgcmVzdFxuICAgICAgICAgICAgZm9yICh2YXIgbT0wOyBtPG4tMTsgbSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXAxID0gbnVtZXJpYy5tdWwoIDIqbi0xLCBudW1lcmljLm11bCh4LCBQbm1fbWludXMxW21dKSApO1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wMiA9IG51bWVyaWMubXVsKCBuK20tMSwgUG5tX21pbnVzMlttXSApO1xuICAgICAgICAgICAgICAgIFBubVttXSA9IG51bWVyaWMuZGl2KCBudW1lcmljLnN1Yih0ZW1wMSwgdGVtcDIpLCBuLW0pOyAvLyBQX2wgPSAoICgybC0xKXhQXyhsLTEpIC0gKGwrbS0xKVBfKGwtMikgKS8obC1tKVxuICAgICAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gUG5tO1xufVxuXG4vLyBwaW52X3N2ZCBjb21wdXRlcyB0aGUgcHNldWRvLWludmVyc2UgdXNpbmcgU1ZEXG5leHBvcnQgZnVuY3Rpb24gcGludl9zdmQoQSkge1xuICAgIHZhciB6ID0gbnVtZXJpYy5zdmQoQSksIGZvbyA9IHouU1swXTtcbiAgICB2YXIgVSA9IHouVSwgUyA9IHouUywgViA9IHouVjtcbiAgICB2YXIgbSA9IEEubGVuZ3RoLCBuID0gQVswXS5sZW5ndGgsIHRvbCA9IE1hdGgubWF4KG0sbikqbnVtZXJpYy5lcHNpbG9uKmZvbyxNID0gUy5sZW5ndGg7XG4gICAgdmFyIFNpbnYgPSBuZXcgQXJyYXkoTSk7XG4gICAgZm9yKHZhciBpPU0tMTtpIT09LTE7aS0tKSB7IGlmKFNbaV0+dG9sKSBTaW52W2ldID0gMS9TW2ldOyBlbHNlIFNpbnZbaV0gPSAwOyB9XG4gICAgcmV0dXJuIG51bWVyaWMuZG90KG51bWVyaWMuZG90KFYsbnVtZXJpYy5kaWFnKFNpbnYpKSxudW1lcmljLnRyYW5zcG9zZShVKSlcbn1cblxuLy8gcGludl9zdmQgY29tcHV0ZXMgdGhlIGxlZnQgcHNldWRvLWludmVyc2VcbmV4cG9ydCBmdW5jdGlvbiBwaW52X2RpcmVjdChBKSB7XG4gICAgdmFyIEFUID0gbnVtZXJpYy50cmFuc3Bvc2UoQSk7XG4gICAgcmV0dXJuIG51bWVyaWMuZG90KG51bWVyaWMuaW52KG51bWVyaWMuZG90KEFULEEpKSxBVCk7XG59XG5cbi8vIGNvbXB1dGVzIHJvdGF0aW9uIG1hdHJpY2VzIGZvciByZWFsIHNwaGVyaWNhbCBoYXJtb25pY3NcbmV4cG9ydCBmdW5jdGlvbiBnZXRTSHJvdE10eChSeHl6LCBMKSB7XG5cbiAgICB2YXIgTnNoID0gKEwrMSkqKEwrMSk7XG4gICAgLy8gYWxsb2NhdGUgdG90YWwgcm90YXRpb24gbWF0cml4XG4gICAgdmFyIFIgPSBudW1lcmljLnJlcChbTnNoLE5zaF0sMCk7XG5cbiAgICAvLyBpbml0aWFsaXplIHplcm90aCBhbmQgZmlyc3QgYmFuZCByb3RhdGlvbiBtYXRyaWNlcyBmb3IgcmVjdXJzaW9uXG4gICAgLy8gUnh5eiA9IFtSeHggUnh5IFJ4elxuICAgIC8vICAgICAgICAgUnl4IFJ5eSBSeXpcbiAgICAvLyAgICAgICAgIFJ6eCBSenkgUnp6XVxuICAgIC8vXG4gICAgLy8gemVyb3RoLWJhbmQgKGw9MCkgaXMgaW52YXJpYW50IHRvIHJvdGF0aW9uXG4gICAgUlswXVswXSA9IDE7XG5cbiAgICAvLyB0aGUgZmlyc3QgYmFuZCAobD0xKSBpcyBkaXJlY3RseSByZWxhdGVkIHRvIHRoZSByb3RhdGlvbiBtYXRyaXhcbiAgICB2YXIgUl8xID0gbnVtZXJpYy5yZXAoWzMsM10sMCk7XG4gICAgUl8xWzBdWzBdID0gUnh5elsxXVsxXTtcbiAgICBSXzFbMF1bMV0gPSBSeHl6WzFdWzJdO1xuICAgIFJfMVswXVsyXSA9IFJ4eXpbMV1bMF07XG4gICAgUl8xWzFdWzBdID0gUnh5elsyXVsxXTtcbiAgICBSXzFbMV1bMV0gPSBSeHl6WzJdWzJdO1xuICAgIFJfMVsxXVsyXSA9IFJ4eXpbMl1bMF07XG4gICAgUl8xWzJdWzBdID0gUnh5elswXVsxXTtcbiAgICBSXzFbMl1bMV0gPSBSeHl6WzBdWzJdO1xuICAgIFJfMVsyXVsyXSA9IFJ4eXpbMF1bMF07XG5cbiAgICBSID0gbnVtZXJpYy5zZXRCbG9jayhSLCBbMSwxXSwgWzMsM10sIFJfMSk7XG4gICAgdmFyIFJfbG0xID0gUl8xO1xuXG4gICAgLy8gY29tcHV0ZSByb3RhdGlvbiBtYXRyaXggb2YgZWFjaCBzdWJzZXF1ZW50IGJhbmQgcmVjdXJzaXZlbHlcbiAgICB2YXIgYmFuZF9pZHggPSAzO1xuICAgIGZvciAodmFyIGw9MjsgbDxMKzE7IGwrKykge1xuXG4gICAgICAgIHZhciBSX2wgPSBudW1lcmljLnJlcChbKDIqbCsxKSwoMipsKzEpXSwwKTtcbiAgICAgICAgZm9yICh2YXIgbT0tbDsgbTxsKzE7IG0rKykge1xuICAgICAgICAgICAgZm9yICh2YXIgbj0tbDsgbjxsKzE7IG4rKykge1xuICAgICAgICAgICAgICAgIC8vIGNvbXB1dGUgdSx2LHcgdGVybXMgb2YgRXEuOC4xIChUYWJsZSBJKVxuICAgICAgICAgICAgICAgIHZhciBkLCBkZW5vbSwgdSwgdiwgdztcbiAgICAgICAgICAgICAgICBpZiAobT09MCkgZCA9IDE7XG4gICAgICAgICAgICAgICAgZWxzZSBkID0gMDsgLy8gdGhlIGRlbHRhIGZ1bmN0aW9uIGRfbTBcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMobik9PWwpIGRlbm9tID0gKDIqbCkqKDIqbC0xKTtcbiAgICAgICAgICAgICAgICBlbHNlIGRlbm9tID0gKGwqbC1uKm4pO1xuXG4gICAgICAgICAgICAgICAgdSA9IE1hdGguc3FydCgobCpsLW0qbSkvZGVub20pO1xuICAgICAgICAgICAgICAgIHYgPSBNYXRoLnNxcnQoKDErZCkqKGwrTWF0aC5hYnMobSktMSkqKGwrTWF0aC5hYnMobSkpL2Rlbm9tKSooMS0yKmQpKjAuNTtcbiAgICAgICAgICAgICAgICB3ID0gTWF0aC5zcXJ0KChsLU1hdGguYWJzKG0pLTEpKihsLU1hdGguYWJzKG0pKS9kZW5vbSkqKDEtZCkqKC0wLjUpO1xuXG4gICAgICAgICAgICAgICAgLy8gY29tcHV0ZXMgRXEuOC4xXG4gICAgICAgICAgICAgICAgaWYgKHUhPTApIHUgPSB1KlUobCxtLG4sUl8xLFJfbG0xKTtcbiAgICAgICAgICAgICAgICBpZiAodiE9MCkgdiA9IHYqVihsLG0sbixSXzEsUl9sbTEpO1xuICAgICAgICAgICAgICAgIGlmICh3IT0wKSB3ID0gdypXKGwsbSxuLFJfMSxSX2xtMSk7XG4gICAgICAgICAgICAgICAgUl9sW20rbF1bbitsXSA9IHUgKyB2ICsgdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBSID0gbnVtZXJpYy5zZXRCbG9jayhSLCBbYmFuZF9pZHgrMSxiYW5kX2lkeCsxXSwgW2JhbmRfaWR4KzIqbCsxLGJhbmRfaWR4KzIqbCsxXSwgUl9sKTtcbiAgICAgICAgUl9sbTEgPSBSX2w7XG4gICAgICAgIGJhbmRfaWR4ID0gYmFuZF9pZHggKyAyKmwrMTtcbiAgICB9XG4gICAgcmV0dXJuIFI7XG59XG5cbi8vIGZ1bmN0aW9ucyB0byBjb21wdXRlIHRlcm1zIFUsIFYsIFcgb2YgRXEuOC4xIChUYWJsZSBJSSlcbmV4cG9ydCBmdW5jdGlvbiBVKGwsbSxuLFJfMSxSX2xtMSkge1xuXG4gICAgcmV0dXJuIFAoMCxsLG0sbixSXzEsUl9sbTEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gVihsLG0sbixSXzEsUl9sbTEpIHtcblxuICAgIHZhciBwMCwgcDEsIHJldCwgZDtcbiAgICBpZiAobT09MCkge1xuICAgICAgICBwMCA9IFAoMSxsLDEsbixSXzEsUl9sbTEpO1xuICAgICAgICBwMSA9IFAoLTEsbCwtMSxuLFJfMSxSX2xtMSk7XG4gICAgICAgIHJldCA9IHAwK3AxO1xuICAgIH1cbiAgICBlbHNlIGlmIChtPjApIHtcbiAgICAgICAgaWYgKG09PTEpIGQgPSAxO1xuICAgICAgICBlbHNlIGQgPSAwO1xuICAgICAgICBwMCA9IFAoMSxsLG0tMSxuLFJfMSxSX2xtMSk7XG4gICAgICAgIHAxID0gUCgtMSxsLC1tKzEsbixSXzEsUl9sbTEpO1xuICAgICAgICByZXQgPSBwMCpNYXRoLnNxcnQoMStkKSAtIHAxKigxLWQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKG09PS0xKSBkID0gMTtcbiAgICAgICAgZWxzZSBkID0gMDtcbiAgICAgICAgcDAgPSBQKDEsbCxtKzEsbixSXzEsUl9sbTEpO1xuICAgICAgICBwMSA9IFAoLTEsbCwtbS0xLG4sUl8xLFJfbG0xKTtcbiAgICAgICAgcmV0ID0gcDAqKDEtZCkgKyBwMSpNYXRoLnNxcnQoMStkKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFcobCxtLG4sUl8xLFJfbG0xKSB7XG5cbiAgICB2YXIgcDAsIHAxLCByZXQ7XG4gICAgaWYgKG09PTApIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcInNob3VsZCBub3QgYmUgY2FsbGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKG0+MCkge1xuICAgICAgICAgICAgcDAgPSBQKDEsbCxtKzEsbixSXzEsUl9sbTEpO1xuICAgICAgICAgICAgcDEgPSBQKC0xLGwsLW0tMSxuLFJfMSxSX2xtMSk7XG4gICAgICAgICAgICByZXQgPSBwMCArIHAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcDAgPSBQKDEsbCxtLTEsbixSXzEsUl9sbTEpO1xuICAgICAgICAgICAgcDEgPSBQKC0xLGwsLW0rMSxuLFJfMSxSX2xtMSk7XG4gICAgICAgICAgICByZXQgPSBwMCAtIHAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5cbi8vIGZ1bmN0aW9uIHRvIGNvbXB1dGUgdGVybSBQIG9mIFUsVixXIChUYWJsZSBJSSlcbmV4cG9ydCBmdW5jdGlvbiBQKGksbCxhLGIsUl8xLFJfbG0xKSB7XG5cbiAgICB2YXIgcmkxLCByaW0xLCByaTAsIHJldDtcbiAgICByaTEgPSBSXzFbaSsxXVsxKzFdO1xuICAgIHJpbTEgPSBSXzFbaSsxXVstMSsxXTtcbiAgICByaTAgPSBSXzFbaSsxXVswKzFdO1xuXG4gICAgaWYgKGI9PS1sKSB7XG4gICAgICAgIHJldCA9IHJpMSpSX2xtMVthK2wtMV1bMF0gKyByaW0xKlJfbG0xW2ErbC0xXVsyKmwtMl07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoYj09bCkgcmV0ID0gcmkxKlJfbG0xW2ErbC0xXVsyKmwtMl0gLSByaW0xKlJfbG0xW2ErbC0xXVswXTtcbiAgICAgICAgZWxzZSByZXQgPSByaTAqUl9sbTFbYStsLTFdW2IrbC0xXTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cblxuLy8geWF3UGl0Y2hSb2xsMlJ6eXggY29tcHV0ZXMgdGhlIHJvdGF0aW9uIG1hdHJpeCBmcm9tIFpZJ1gnJyByb3RhdGlvbiBhbmdsZXNcbmV4cG9ydCBmdW5jdGlvbiB5YXdQaXRjaFJvbGwyUnp5eCh5YXcsIHBpdGNoLCByb2xsKSB7XG5cbiAgICBsZXQgUngsIFJ5LCBSejtcbiAgICBpZiAocm9sbCA9PSAwKSBSeCA9IFtbMSwwLDBdLFswLDEsMF0sWzAsMCwxXV07XG4gICAgZWxzZSBSeCA9IFtbMSwgMCwgMF0sIFswLCBNYXRoLmNvcyhyb2xsKSwgTWF0aC5zaW4ocm9sbCldLCBbMCwgLU1hdGguc2luKHJvbGwpLCBNYXRoLmNvcyhyb2xsKV1dO1xuICAgIGlmIChwaXRjaCA9PSAwKSBSeSA9IFtbMSwwLDBdLFswLDEsMF0sWzAsMCwxXV07XG4gICAgZWxzZSBSeSA9IFtbTWF0aC5jb3MocGl0Y2gpLCAwLCAtTWF0aC5zaW4ocGl0Y2gpXSwgWzAsIDEsIDBdLCBbTWF0aC5zaW4ocGl0Y2gpLCAwLCBNYXRoLmNvcyhwaXRjaCldXTtcbiAgICBpZiAoeWF3ID09IDApIFJ6ID0gW1sxLDAsMF0sWzAsMSwwXSxbMCwwLDFdXTtcbiAgICBlbHNlIFJ6ID0gW1tNYXRoLmNvcyh5YXcpLCBNYXRoLnNpbih5YXcpLCAwXSwgWy1NYXRoLnNpbih5YXcpLCBNYXRoLmNvcyh5YXcpLCAwXSwgWzAsIDAsIDFdXTtcblxuICAgIGxldCBSID0gbnVtZXJpYy5kb3RNTXNtYWxsKFJ5LFJ6KTtcbiAgICBSID0gbnVtZXJpYy5kb3RNTXNtYWxsKFJ4LFIpO1xuICAgIHJldHVybiBSO1xufVxuIl19