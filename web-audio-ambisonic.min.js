!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.webAudioAmbisonic=e()}}(function(){var define,module,exports;return function e(r,n,t){function i(a,u){if(!n[a]){if(!r[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};r[a][0].call(f.exports,function(e){var n=r[a][1][e];return i(n?n:e)},f,f.exports,e,r,n,t)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<t.length;a++)i(t[a]);return i}({1:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.fftSize=2048,this.analysers=new Array(4),this.analBuffers=new Array(4),this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4);for(var n=0;n<4;n++)this.analysers[n]=this.ctx.createAnalyser(),this.analysers[n].fftSize=this.fftSize,this.analysers[n].smoothingTimeConstant=0,this.analBuffers[n]=new Float32Array(this.fftSize);for(var t=0;t<4;t++)this.in.connect(this.out,t,t),this.in.connect(this.analysers[t],t,0);this.initialized=!0}return(0,u.default)(e,[{key:"updateBuffers",value:function(){for(var e=0;e<4;e++)this.analysers[e].getFloatTimeDomainData(this.analBuffers[e])}},{key:"computeIntensity",value:function(){for(var e,r,n,t,i,o,a=0,u=0,s=0,c=0,f=0,h=0,l=0,m=0;m<this.fftSize;m++)a+=Math.sqrt(2)*this.analBuffers[0][m]*this.analBuffers[1][m],u+=Math.sqrt(2)*this.analBuffers[0][m]*this.analBuffers[2][m],s+=Math.sqrt(2)*this.analBuffers[0][m]*this.analBuffers[3][m],c+=2*this.analBuffers[0][m]*this.analBuffers[0][m],f+=this.analBuffers[1][m]*this.analBuffers[1][m],h+=this.analBuffers[2][m]*this.analBuffers[2][m],l+=this.analBuffers[3][m]*this.analBuffers[3][m];e=[a,u,s],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=(c+f+h+l)/2,t=1-r/(n+1e-7),i=180*Math.atan2(u,a)/Math.PI,o=180*Math.atan2(e[2],Math.sqrt(e[0]*e[0]+e[1]*e[1]))/Math.PI;var d=[i,o,t,n];return d}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],2:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.decFilters=new Array(4),this.decFilterNodes=new Array(4),this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(2),this.gainMid=this.ctx.createGain(),this.gainSide=this.ctx.createGain(),this.invertSide=this.ctx.createGain(),this.gainMid.gain.value=1,this.gainSide.gain.value=1,this.invertSide.gain.value=-1;for(var n=0;n<4;n++)this.decFilterNodes[n]=this.ctx.createConvolver(),this.decFilterNodes[n].normalize=!1;this.resetFilters();for(var n=0;n<4;n++)this.in.connect(this.decFilterNodes[n],n,0),2==n?this.decFilterNodes[n].connect(this.gainSide,0,0):this.decFilterNodes[n].connect(this.gainMid,0,0);this.gainMid.connect(this.out,0,0),this.gainSide.connect(this.out,0,0),this.gainMid.connect(this.out,0,1),this.gainSide.connect(this.invertSide,0,0),this.invertSide.connect(this.out,0,1),this.initialized=!0}return(0,u.default)(e,[{key:"updateFilters",value:function(e){for(var r=0;r<4;r++)this.decFilters[r]=this.ctx.createBuffer(1,e.length,e.sampleRate),this.decFilters[r].getChannelData(0).set(e.getChannelData(r)),this.decFilterNodes[r].buffer=this.decFilters[r]}},{key:"resetFilters",value:function(){for(var e=[.5*Math.SQRT2,0,.5,0],r=0;r<4;r++)this.decFilters[r]=this.ctx.createBuffer(1,1,this.ctx.sampleRate),this.decFilters[r].getChannelData(0).set([e[r]]),this.decFilterNodes[r].buffer=this.decFilters[r]}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],3:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.azi=0,this.elev=0,this.gainNodes=new Array(4),this.in=this.ctx.createGain(),this.out=this.ctx.createChannelMerger(4),this.gains=[Math.SQRT1_2,1,0,0];for(var n=0;n<4;n++)this.gainNodes[n]=this.ctx.createGain(),this.gainNodes[n].gain.value=this.gains[n];for(var t=0;t<4;t++)this.in.connect(this.gainNodes[t]),this.gainNodes[t].connect(this.out,0,t);this.initialized=!0}return(0,u.default)(e,[{key:"updateGains",value:function(){var e=this.azi*Math.PI/180,r=this.elev*Math.PI/180;this.gains[1]=Math.cos(e)*Math.cos(r),this.gains[2]=Math.sin(e)*Math.cos(r),this.gains[3]=Math.sin(r);for(var n=1;n<4;n++)this.gainNodes[n].gain.value=this.gains[n]}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],4:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.yaw=0,this.pitch=0,this.roll=0,this.rotMtx=[[],[],[]],this.rotMtxNodes=[[],[],[]],this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4);for(var n=0;n<3;n++)for(var t=0;t<3;t++)this.rotMtxNodes[n][t]=context.createGain(),n==t?this.rotMtxNodes[n][t].gain.value=1:this.rotMtxNodes[n][t].gain.value=0;this.in.connect(this.out,0,0);for(var i=0;i<3;i++)for(var a=0;a<3;a++)this.in.connect(this.rotMtxNodes[i][a],a+1,0),this.rotMtxNodes[i][a].connect(this.out,0,i+1);this.initialized=!0}return(0,u.default)(e,[{key:"updateRotMtx",value:function(){var e,r,n,t,i,o,a,u,s,c=this.yaw*Math.PI/180,f=this.pitch*Math.PI/180,h=this.roll*Math.PI/180;e=Math.cos(f)*Math.cos(c),r=Math.cos(f)*Math.sin(c),n=-Math.sin(f),t=Math.cos(c)*Math.sin(f)*Math.sin(h)-Math.cos(h)*Math.sin(c),i=Math.cos(h)*Math.cos(c)+Math.sin(f)*Math.sin(h)*Math.sin(c),o=Math.cos(f)*Math.sin(h),a=Math.sin(h)*Math.sin(c)+Math.cos(h)*Math.cos(c)*Math.sin(f),u=Math.cos(h)*Math.sin(f)*Math.sin(c)-Math.cos(c)*Math.sin(h),s=Math.cos(f)*Math.cos(h),this.rotMtx=[[e,r,n],[t,i,o],[a,u,s]];for(var l=0;l<3;l++)for(var m=0;m<3;m++)this.rotMtxNodes[l][m].gain.value=this.rotMtx[l][m]}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],5:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.azi=0,this.elev=0,this.vmicGainNodes=new Array(4),this.vmicCoeff=.5,this.vmicPattern="cardioid",this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createGain(),this.vmicGains=[.5*Math.SQRT2,.5,0,0];for(var n=0;n<4;n++)this.vmicGainNodes[n]=this.ctx.createGain(),this.vmicGainNodes[n].gain.value=this.vmicGains[n];for(this.xyz=[1,0,0],n=0;n<4;n++)this.in.connect(this.vmicGainNodes[n],n,0),this.vmicGainNodes[n].connect(this.out);this.initialized=!0}return(0,u.default)(e,[{key:"updatePattern",value:function(){switch(this.vmicPattern){case"subcardioid":this.vmicCoeff=2/3;break;case"cardioid":this.vmicCoeff=.5;break;case"supercardioid":this.vmicCoeff=(Math.sqrt(3)-1)/2;break;case"hypercardioid":this.vmicCoeff=.25;break;case"dipole":this.vmicCoeff=0;break;default:this.vmicPattern="cardioid",this.vmicCoeff=.5}this.updateGains()}},{key:"updateOrientation",value:function(){var e=this.azi*Math.PI/180,r=this.elev*Math.PI/180;this.xyz[0]=Math.cos(e)*Math.cos(r),this.xyz[1]=Math.sin(e)*Math.cos(r),this.xyz[2]=Math.sin(r),this.updateGains()}},{key:"updateGains",value:function(){var e=this.vmicCoeff,r=this.xyz;this.vmicGains[0]=e*Math.SQRT2,this.vmicGains[1]=(1-e)*r[0],this.vmicGains[2]=(1-e)*r[1],this.vmicGains[3]=(1-e)*r[2];for(var n=0;n<4;n++)this.vmicGainNodes[n].gain.value=this.vmicGains[n]}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],6:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r,n){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.order=n,this.nCh=(n+1)*(n+1),this.fftSize=2048,this.analysers=new Array(this.nCh),this.analBuffers=new Array(this.nCh),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh);for(var t=0;t<this.nCh;t++)this.analysers[t]=this.ctx.createAnalyser(),this.analysers[t].fftSize=this.fftSize,this.analysers[t].smoothingTimeConstant=0,this.analBuffers[t]=new Float32Array(this.fftSize);for(var i=0;i<this.nCh;i++)this.in.connect(this.out,i,i),this.in.connect(this.analysers[i],i,0);this.initialized=!0}return(0,u.default)(e,[{key:"updateBuffers",value:function(){for(var e=0;e<this.nCh;e++)this.analysers[e].getFloatTimeDomainData(this.analBuffers[e])}},{key:"computeIntensity",value:function(){for(var e,r,n,t,i,o=new Array(this.nCh).fill(0),a=new Array(this.nCh).fill(0),u=0;u<this.fftSize;u++)for(var s=0;s<this.nCh;s++)0==s?a[s]+=2*this.analBuffers[s][u]*this.analBuffers[s][u]:(a[s]+=this.analBuffers[s][u]*this.analBuffers[s][u],o[s]+=Math.sqrt(2)*this.analBuffers[0][u]*this.analBuffers[s][u]);for(var c=0,f=0,h=0;h<o.length;h++)0!=h&&(c+=o[h]*o[h]),f+=a[h];e=Math.sqrt(c),r=f/2,n=1-e/(r+1e-7),t=180*Math.atan2(o[1],o[3])/Math.PI,i=180*Math.atan2(o[2],Math.sqrt(o[1]*o[1]+o[3]*o[3]))/Math.PI;var l=[t,i,n,r];return l}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],7:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.HOA_fuma2acn=n.HOA_acn2bf=n.HOA_bf2acn=void 0;var i=e("babel-runtime/helpers/classCallCheck"),o=t(i);n.HOA_bf2acn=function e(r){(0,o.default)(this,e),this.ctx=r,this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4),this.gains=[];for(var n=0;n<4;n++)this.gains[n]=this.ctx.createGain(),0==n?this.gains[n].gain.value=Math.SQRT2:this.gains[n].gain.value=Math.sqrt(3),this.gains[n].connect(this.out,0,n);this.in.connect(this.gains[0],0,0),this.in.connect(this.gains[3],1,0),this.in.connect(this.gains[1],2,0),this.in.connect(this.gains[2],3,0)},n.HOA_acn2bf=function e(r){(0,o.default)(this,e),this.ctx=r,this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4),this.gains=[];for(var n=0;n<4;n++)this.gains[n]=this.ctx.createGain(),0==n?this.gains[n].gain.value=Math.SQRT1_2:this.gains[n].gain.value=1/Math.sqrt(3),this.gains[n].connect(this.out,0,n);this.in.connect(this.gains[0],0,0),this.in.connect(this.gains[2],1,0),this.in.connect(this.gains[3],2,0),this.in.connect(this.gains[1],3,0)},n.HOA_fuma2acn=function e(r,n){(0,o.default)(this,e),this.ctx=r,this.order=n,this.nCh=(n+1)*(n+1),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=[],this.remapArray=[],this.remapArray.push(0,2,3,1);for(var t,i=0,a=0;a<this.nCh;a++)if(t=[],a>=(i+1)*(i+1)){i+=1;for(var u=(i+1)*(i+1);u<(i+2)*(i+2);u++)(u+i%2)%2==0?t.push(u):t.unshift(u);this.remapArray=this.remapArray.concat(t)}for(var a=0;a<this.nCh;a++)this.gains[a]=this.ctx.createGain(),this.in.connect(this.gains[a],this.remapArray[a],0),this.gains[a].connect(this.out,0,a)}},{"babel-runtime/helpers/classCallCheck":16}],8:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r,n){(0,o.default)(this,e),this.initialized=!1,this.ctx=r,this.order=n,this.nCh=(n+1)*(n+1),this.decFilters=new Array(this.nCh),this.decFilterNodes=new Array(this.nCh),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(2),this.gainMid=this.ctx.createGain(),this.gainSide=this.ctx.createGain(),this.invertSide=this.ctx.createGain(),this.gainMid.gain.value=1,this.gainSide.gain.value=1,this.invertSide.gain.value=-1;for(var t=0;t<this.nCh;t++)this.decFilterNodes[t]=this.ctx.createConvolver(),this.decFilterNodes[t].normalize=!1;this.resetFilters();for(var t=0;t<this.nCh;t++){this.in.connect(this.decFilterNodes[t],t,0);var i=Math.floor(Math.sqrt(t)),a=t-i*i-i;a>=0?this.decFilterNodes[t].connect(this.gainMid):this.decFilterNodes[t].connect(this.gainSide)}this.gainMid.connect(this.out,0,0),this.gainSide.connect(this.out,0,0),this.gainMid.connect(this.out,0,1),this.gainSide.connect(this.invertSide,0,0),this.invertSide.connect(this.out,0,1),this.initialized=!0}return(0,u.default)(e,[{key:"updateFilters",value:function(e){for(var r=0;r<this.nCh;r++)this.decFilters[r]=this.ctx.createBuffer(1,e.length,e.sampleRate),this.decFilters[r].getChannelData(0).set(e.getChannelData(r)),this.decFilterNodes[r].buffer=this.decFilters[r]}},{key:"resetFilters",value:function(){var e=new Array(this.nCh);e.fill(0),e[0]=.5,e[1]=.5/Math.sqrt(3);for(var r=0;r<this.nCh;r++)this.decFilters[r]=this.ctx.createBuffer(1,1,this.ctx.sampleRate),this.decFilters[r].getChannelData(0).set([e[r]]),this.decFilterNodes[r].buffer=this.decFilters[r]}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],9:[function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),a=i(o),u=e("babel-runtime/helpers/createClass"),s=i(u),c=e("spherical-harmonic-transform"),f=t(c),h=function(){function e(r,n){(0,a.default)(this,e),this.initialized=!1,this.ctx=r,this.order=n,this.nCh=(n+1)*(n+1),this.azi=0,this.elev=0,this.gains=new Array(this.nCh),this.gainNodes=new Array(this.nCh),this.in=this.ctx.createGain(),this.in.channelCountMode="explicit",this.in.channelCount=1,this.out=this.ctx.createChannelMerger(this.nCh);for(var t=0;t<this.nCh;t++)this.gainNodes[t]=this.ctx.createGain(),this.gainNodes[t].channelCountMode="explicit",this.gainNodes[t].channelCount=1;this.updateGains();for(var t=0;t<this.nCh;t++)this.in.connect(this.gainNodes[t]),this.gainNodes[t].connect(this.out,0,t);this.initialized=!0}return(0,s.default)(e,[{key:"updateGains",value:function(){for(var e=this.order,r=f.computeRealSH(e,[[this.azi*Math.PI/180,this.elev*Math.PI/180]]),n=0;n<this.nCh;n++)this.gains[n]=r[n][0],this.gainNodes[n].gain.value=this.gains[n]}}]),e}();n.default=h},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17,"spherical-harmonic-transform":36}],10:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r,n,t){(0,o.default)(this,e),this.ctx=r,this.orderIn=n,t<n?this.orderOut=t:this.orderOut=n,this.nChIn=(this.orderIn+1)*(this.orderIn+1),this.nChOut=(this.orderOut+1)*(this.orderOut+1),this.in=this.ctx.createChannelSplitter(this.nChIn),this.out=this.ctx.createChannelMerger(this.nChOut);for(var i=0;i<this.nChOut;i++)this.in.connect(this.out,i,i)}return(0,u.default)(e,[{key:"updateOrder",value:function(e){if(e<=this.orderIn){this.orderOut=e,this.nChOut=(this.orderOut+1)*(this.orderOut+1),this.out.disconnect(),this.out=this.ctx.createChannelMerger(this.nChOut);for(var r=0;r<this.nChOut;r++)this.in.connect(this.out,r,r)}}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],11:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=t(i),a=e("babel-runtime/helpers/createClass"),u=t(a),s=function(){function e(r,n,t,i){function a(e,r){return("000000000"+e).substr(-r)}(0,o.default)(this,e),this.context=r,this.order=n,this.nCh=(n+1)*(n+1),this.nChGroups=Math.ceil(this.nCh/8),this.buffers=new Array,this.loadCount=0,this.loaded=!1,this.onLoad=i,this.urls=new Array(this.nChGroups);for(var u=t.slice(t.length-3,t.length),s=0;s<this.nChGroups;s++)s==this.nChGroups-1?this.urls[s]=t.slice(0,t.length-4)+"_"+a(8*s+1,2)+"-"+a(this.nCh,2)+"ch."+u:this.urls[s]=t.slice(0,t.length-4)+"_"+a(8*s+1,2)+"-"+a(8*s+8,2)+"ch."+u}return(0,u.default)(e,[{key:"loadBuffers",value:function(e,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer";var t=this;n.onload=function(){t.context.decodeAudioData(n.response,function(n){return n?(t.buffers[r]=n,t.loadCount++,void(t.loadCount==t.nChGroups&&(t.loaded=!0,t.concatBuffers(),console.log("HOAloader: all buffers loaded and concatenated"),t.onLoad(t.concatBuffer)))):void alert("error decoding file data: "+e)},function(e){console.error("decodeAudioData error",e)})},n.onerror=function(){alert("HOAloader: XHR error")},n.send()}},{key:"load",value:function(){for(var e=0;e<this.nChGroups;++e)this.loadBuffers(this.urls[e],e)}},{key:"concatBuffers",value:function(){if(this.loaded){var e=this.nCh,r=this.nChGroups,n=this.buffers[0].length,t=this.buffers[0].sampleRate;this.concatBuffer=this.context.createBuffer(e,n,t);for(var i=0;i<r;i++)for(var o=0;o<this.buffers[i].numberOfChannels;o++)this.concatBuffer.getChannelData(8*i+o).set(this.buffers[i].getChannelData(o))}}}]),e}();n.default=s},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17}],12:[function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),a=i(o),u=e("babel-runtime/helpers/createClass"),s=i(u),c=e("spherical-harmonic-transform"),f=t(c),h=function(){function e(r,n){(0,a.default)(this,e),this.ctx=r,this.order=n,this.nCh=(n+1)*(n+1),this.yaw=0,this.pitch=0,this.roll=0,this.rotMtx=numeric.identity(this.nCh),this.rotMtxNodes=new Array(this.order),this.in=null,this.out=null,this.initialized=!1}return(0,s.default)(e,[{key:"updateRotMtx",value:function(){if(this.initialized){var e=this.yaw*Math.PI/180,r=this.pitch*Math.PI/180,n=this.roll*Math.PI/180;this.rotMtx=f.getSHrotMtx(f.yawPitchRoll2Rzyx(e,r,n),this.order);for(var t=1,i=1;i<this.order+1;i++){for(var o=0;o<2*i+1;o++)for(var a=0;a<2*i+1;a++)this.rotMtxNodes[i-1][o][a].gain.value=this.rotMtx[t+o][t+a];t=t+2*i+1}}}},{key:"init",value:function(){if(!this.initialized){this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh);for(var e=1;e<this.order+1;e++){for(var r=new Array(2*e+1),n=0;n<2*e+1;n++){r[n]=new Array(2*e+1);for(var t=0;t<2*e+1;t++)r[n][t]=this.ctx.createGain(),n==t?r[n][t].gain.value=1:r[n][t].gain.value=0}this.rotMtxNodes[e-1]=r}this.in.connect(this.out,0,0);for(var i=1,o=1;o<this.order+1;o++){for(var a=0;a<2*o+1;a++)for(var u=0;u<2*o+1;u++)this.in.connect(this.rotMtxNodes[o-1][a][u],i+u,0),this.rotMtxNodes[o-1][a][u].connect(this.out,0,i+a);i=i+2*o+1}this.initialized=!0}}}]),e}();n.default=h},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17,"spherical-harmonic-transform":36}],13:[function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),a=i(o),u=e("babel-runtime/helpers/createClass"),s=i(u),c=e("spherical-harmonic-transform"),f=t(c),h=function(){function e(r,n){(0,a.default)(this,e),this.initialized=!1,this.ctx=r,this.order=n,this.nCh=(n+1)*(n+1),this.azi=0,this.elev=0,this.vmicGains=new Array(this.nCh),this.vmicGainNodes=new Array(this.nCh),this.vmicCoeffs=new Array(this.order+1),this.vmicPattern="hypercardioid",this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createGain();for(var t=0;t<this.nCh;t++)this.vmicGainNodes[t]=this.ctx.createGain();for(this.SHxyz=new Array(this.nCh),this.SHxyz.fill(0),this.updatePattern(),this.updateOrientation(),t=0;t<this.nCh;t++)this.in.connect(this.vmicGainNodes[t],t,0),this.vmicGainNodes[t].connect(this.out);this.initialized=!0}return(0,s.default)(e,[{key:"updatePattern",value:function(){function e(e){for(var r=new Array(e+1),n=0;n<e+1;n++)r[n]=Math.sqrt(2*n+1)*f.factorial(e)*f.factorial(e+1)/(f.factorial(e+n+1)*f.factorial(e-n))/(e+1);return r}function r(e){var r=new Array(e+1);return r.fill(1),r}function n(e){var r=new Array(e+1);r[0]=1;for(var n=0,t=0,i=0,o=1;o<e+1;o++)i=f.recurseLegendrePoly(o,[Math.cos(2.406809/(e+1.51))],n,t),r[o]=i[0][0],t=n,n=i;return r}switch(this.vmicPattern){case"cardioid":this.vmicCoeffs=e(this.order);break;case"supercardioid":break;case"hypercardioid":this.vmicCoeffs=r(this.order);break;case"max_rE":this.vmicCoeffs=n(this.order);break;default:this.vmicPattern="hypercardioid",this.vmicCoeffs=r(this.order)}this.updateGains()}},{key:"updateOrientation",value:function(){for(var e=this.azi*Math.PI/180,r=this.elev*Math.PI/180,n=f.computeRealSH(this.order,[[e,r]]),t=1;t<this.nCh;t++)this.SHxyz[t]=n[t][0];this.updateGains()}},{key:"updateGains",value:function(){for(var e,r=0;r<this.order+1;r++)for(var n=-this.order;n<this.order+1;n++)e=r*r+r+n,this.vmicGains[e]=1/Math.sqrt(2*r+1)*this.vmicCoeffs[r]*this.SHxyz[e];for(var t=1;t<this.nCh;t++)this.vmicGainNodes[t].gain.value=this.vmicGains[t]}}]),e}();n.default=h},{"babel-runtime/helpers/classCallCheck":16,"babel-runtime/helpers/createClass":17,"spherical-harmonic-transform":36}],14:[function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.Bformat_analyser=n.Bformat_binDecoder=n.Bformat_vmic=n.Bformat_rotator=n.Bformat_encoder=n.hoa_converters=n.HOAloader=n.HOA_analyser=n.HOA_vmic=n.HOA_binDecoder=n.HOA_rotator=n.HOA_orderLimiter=n.HOA_encoder=void 0;var o=e("./hoa-encoder");Object.defineProperty(n,"HOA_encoder",{enumerable:!0,get:function(){return i(o).default}});var a=e("./hoa-limiter");Object.defineProperty(n,"HOA_orderLimiter",{enumerable:!0,get:function(){return i(a).default}});var u=e("./hoa-rotator");Object.defineProperty(n,"HOA_rotator",{enumerable:!0,get:function(){return i(u).default}});var s=e("./hoa-decoderBin");Object.defineProperty(n,"HOA_binDecoder",{enumerable:!0,get:function(){return i(s).default}});var c=e("./hoa-virtualMic");Object.defineProperty(n,"HOA_vmic",{enumerable:!0,get:function(){return i(c).default}});var f=e("./hoa-analyser");Object.defineProperty(n,"HOA_analyser",{enumerable:!0,get:function(){return i(f).default}});var h=e("./hoa-loader");Object.defineProperty(n,"HOAloader",{enumerable:!0,get:function(){return i(h).default}});var l=e("./foa-encoder");Object.defineProperty(n,"Bformat_encoder",{enumerable:!0,get:function(){return i(l).default}});var m=e("./foa-rotator");Object.defineProperty(n,"Bformat_rotator",{enumerable:!0,get:function(){return i(m).default}});var d=e("./foa-virtualMic");Object.defineProperty(n,"Bformat_vmic",{enumerable:!0,get:function(){return i(d).default}});var p=e("./foa-decoderBin");Object.defineProperty(n,"Bformat_binDecoder",{enumerable:!0,get:function(){return i(p).default}});var v=e("./foa-analyser");Object.defineProperty(n,"Bformat_analyser",{enumerable:!0,get:function(){return i(v).default}});var y=e("./hoa-converters"),g=t(y);n.hoa_converters=g},{"./foa-analyser":1,"./foa-decoderBin":2,"./foa-encoder":3,"./foa-rotator":4,"./foa-virtualMic":5,"./hoa-analyser":6,"./hoa-converters":7,"./hoa-decoderBin":8,"./hoa-encoder":9,"./hoa-limiter":10,"./hoa-loader":11,"./hoa-rotator":12,"./hoa-virtualMic":13}],15:[function(e,r,n){r.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":18}],16:[function(e,r,n){"use strict";n.__esModule=!0,n.default=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}},{}],17:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/object/define-property"),o=t(i);n.default=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),(0,o.default)(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}()},{"../core-js/object/define-property":15}],18:[function(e,r,n){e("../../modules/es6.object.define-property");var t=e("../../modules/_core").Object;r.exports=function(e,r,n){return t.defineProperty(e,r,n)}},{"../../modules/_core":21,"../../modules/es6.object.define-property":34}],19:[function(e,r,n){r.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],20:[function(e,r,n){var t=e("./_is-object");r.exports=function(e){if(!t(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":30}],21:[function(e,r,n){var t=r.exports={version:"2.4.0"};"number"==typeof __e&&(__e=t)},{}],22:[function(e,r,n){var t=e("./_a-function");r.exports=function(e,r,n){if(t(e),void 0===r)return e;switch(n){case 1:return function(n){return e.call(r,n)};case 2:return function(n,t){return e.call(r,n,t)};case 3:return function(n,t,i){return e.call(r,n,t,i)}}return function(){return e.apply(r,arguments)}}},{"./_a-function":19}],23:[function(e,r,n){r.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":26}],24:[function(e,r,n){var t=e("./_is-object"),i=e("./_global").document,o=t(i)&&t(i.createElement);r.exports=function(e){return o?i.createElement(e):{}}},{"./_global":27,"./_is-object":30}],25:[function(e,r,n){var t=e("./_global"),i=e("./_core"),o=e("./_ctx"),a=e("./_hide"),u="prototype",s=function(e,r,n){var c,f,h,l=e&s.F,m=e&s.G,d=e&s.S,p=e&s.P,v=e&s.B,y=e&s.W,g=m?i:i[r]||(i[r]={}),x=g[u],b=m?t:d?t[r]:(t[r]||{})[u];m&&(n=r);for(c in n)f=!l&&b&&void 0!==b[c],f&&c in g||(h=f?b[c]:n[c],g[c]=m&&"function"!=typeof b[c]?n[c]:v&&f?o(h,t):y&&b[c]==h?function(e){var r=function(r,n,t){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,t)}return e.apply(this,arguments)};return r[u]=e[u],r}(h):p&&"function"==typeof h?o(Function.call,h):h,p&&((g.virtual||(g.virtual={}))[c]=h,e&s.R&&x&&!x[c]&&a(x,c,h)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,r.exports=s},{"./_core":21,"./_ctx":22,"./_global":27,"./_hide":28}],26:[function(e,r,n){r.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],27:[function(e,r,n){var t=r.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},{}],28:[function(e,r,n){var t=e("./_object-dp"),i=e("./_property-desc");r.exports=e("./_descriptors")?function(e,r,n){return t.f(e,r,i(1,n))}:function(e,r,n){return e[r]=n,e}},{"./_descriptors":23,"./_object-dp":31,"./_property-desc":32}],29:[function(e,r,n){r.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":23,"./_dom-create":24,"./_fails":26}],30:[function(e,r,n){r.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],31:[function(e,r,n){var t=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),a=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,r,n){if(t(e),r=o(r,!0),t(n),i)try{return a(e,r,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[r]=n.value),e}},{"./_an-object":20,"./_descriptors":23,"./_ie8-dom-define":29,"./_to-primitive":33}],32:[function(e,r,n){r.exports=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}}},{}],33:[function(e,r,n){var t=e("./_is-object");r.exports=function(e,r){if(!t(e))return e;var n,i;if(r&&"function"==typeof(n=e.toString)&&!t(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!t(i=n.call(e)))return i;if(!r&&"function"==typeof(n=e.toString)&&!t(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":30}],34:[function(e,r,n){var t=e("./_export");t(t.S+t.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":23,"./_export":25,"./_object-dp":31}],35:[function(require,module,exports){(function(global){"use strict";var numeric="undefined"==typeof exports?function(){}:exports;"undefined"!=typeof global&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,r){var n,t,i,o;for("undefined"==typeof r&&(r=15),i=.5,n=new Date;;){for(i*=2,o=i;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;if(t=new Date,t-n>r)break}for(o=i;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;return t=new Date,1e3*(3*i-1)/(t-n)},numeric._myIndexOf=function(e){var r,n=this.length;for(r=0;r<n;++r)if(this[r]===e)return r;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function r(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+r(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),t=e/Math.pow(10,n),i=t.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,t=1,i=t.toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}function n(e){var i;if("undefined"==typeof e)return t.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof e)return t.push('"'+e+'"'),!1;if("boolean"==typeof e)return t.push(e.toString()),!1;if("number"==typeof e){var o=r(e),a=e.toPrecision(numeric.precision),u=parseFloat(e.toString()).toString(),s=[o,a,u,parseFloat(a).toString(),parseFloat(u).toString()];for(i=1;i<s.length;i++)s[i].length<o.length&&(o=s[i]);return t.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===e)return t.push("null"),!1;if("function"==typeof e){t.push(e.toString());var c=!1;for(i in e)e.hasOwnProperty(i)&&(c?t.push(",\n"):t.push("\n{"),c=!0,t.push(i),t.push(": \n"),n(e[i]));return c&&t.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return t.push("...Large Array..."),!0;var c=!1;for(t.push("["),i=0;i<e.length;i++)i>0&&(t.push(","),c&&t.push("\n ")),c=n(e[i]);return t.push("]"),!0}t.push("{");var c=!1;for(i in e)e.hasOwnProperty(i)&&(c&&t.push(",\n"),c=!0,t.push(i),t.push(": \n"),n(e[i]));return t.push("}"),!0}var t=[];return n(e),t.join("")},numeric.parseDate=function(e){function r(e){if("string"==typeof e)return Date.parse(e.replace(/-/g,"/"));if(!(e instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,t=[];
for(n=0;n<e.length;n++)t[n]=r(e[n]);return t}return r(e)},numeric.parseFloat=function(e){function r(e){if("string"==typeof e)return parseFloat(e);if(!(e instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,t=[];for(n=0;n<e.length;n++)t[n]=r(e[n]);return t}return r(e)},numeric.parseCSV=function(e){var r,n,t=e.split("\n"),i=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,a=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,u=function(e){return e.substr(0,e.length-1)},s=0;for(n=0;n<t.length;n++){var c,f=(t[n]+",").match(o);if(f.length>0){for(i[s]=[],r=0;r<f.length;r++)c=u(f[r]),a.test(c)?i[s][r]=parseFloat(c):i[s][r]=c;s++}}return i},numeric.toCSV=function(e){var r,n,t,i,o,a,u=numeric.dim(e);for(t=u[0],i=u[1],a=[],r=0;r<t;r++){for(o=[],n=0;n<t;n++)o[n]=e[r][n].toString();a[r]=o.join(", ")}return a.join("\n")+"\n"},numeric.getURL=function(e){var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(),r},numeric.imageURL=function(e){function r(e){var r,n,t,i,o,a,u,s,c=e.length,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="";for(r=0;r<c;r+=3)n=e[r],t=e[r+1],i=e[r+2],o=n>>2,a=((3&n)<<4)+(t>>4),u=((15&t)<<2)+(i>>6),s=63&i,r+1>=c?u=s=64:r+2>=c&&(s=64),h+=f.charAt(o)+f.charAt(a)+f.charAt(u)+f.charAt(s);return h}function n(e,r,n){"undefined"==typeof r&&(r=0),"undefined"==typeof n&&(n=e.length);var t,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1,a=0;e.length;for(t=r;t<n;t++)a=255&(o^e[t]),o=o>>>8^i[a];return o^-1}var t,i,o,a,u,s,c,f,h,l,m=e[0].length,d=e[0][0].length,p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,d>>24&255,d>>16&255,d>>8&255,255&d,m>>24&255,m>>16&255,m>>8&255,255&m,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(l=n(p,12,29),p[29]=l>>24&255,p[30]=l>>16&255,p[31]=l>>8&255,p[32]=255&l,t=1,i=0,c=0;c<m;c++){for(c<m-1?p.push(0):p.push(1),u=3*d+1+(0===c)&255,s=3*d+1+(0===c)>>8&255,p.push(u),p.push(s),p.push(255&~u),p.push(255&~s),0===c&&p.push(0),f=0;f<d;f++)for(o=0;o<3;o++)u=e[o][c][f],u=u>255?255:u<0?0:Math.round(u),t=(t+u)%65521,i=(i+t)%65521,p.push(u);p.push(0)}return h=(i<<16)+t,p.push(h>>24&255),p.push(h>>16&255),p.push(h>>8&255),p.push(255&h),a=p.length-41,p[33]=a>>24&255,p[34]=a>>16&255,p[35]=a>>8&255,p[36]=255&a,l=n(p,37),p.push(l>>24&255),p.push(l>>16&255),p.push(l>>8&255),p.push(255&l),p.push(0),p.push(0),p.push(0),p.push(0),p.push(73),p.push(69),p.push(78),p.push(68),p.push(174),p.push(66),p.push(96),p.push(130),"data:image/png;base64,"+r(p)},numeric._dim=function(e){for(var r=[];"object"==typeof e;)r.push(e.length),e=e[0];return r},numeric.dim=function(e){var r,n;return"object"==typeof e?(r=e[0],"object"==typeof r?(n=r[0],"object"==typeof n?numeric._dim(e):[e.length,r.length]):[e.length]):[]},numeric.mapreduce=function(e,r){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+r+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,r){return Function("x","var n = x.length;\nvar i,xi;\n"+r+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(r,n){var t,i;if(!(r instanceof Array&&n instanceof Array))return!1;if(i=r.length,i!==n.length)return!1;for(t=0;t<i;t++)if(r[t]!==n[t]){if("object"!=typeof r[t])return!1;if(!e(r[t],n[t]))return!1}return!0},numeric.rep=function(e,r,n){"undefined"==typeof n&&(n=0);var t,i=e[n],o=Array(i);if(n===e.length-1){for(t=i-2;t>=0;t-=2)o[t+1]=r,o[t]=r;return t===-1&&(o[0]=r),o}for(t=i-1;t>=0;t--)o[t]=numeric.rep(e,r,n+1);return o},numeric.dotMMsmall=function(e,r){var n,t,i,o,a,u,s,c,f,h,l;for(o=e.length,a=r.length,u=r[0].length,s=Array(o),n=o-1;n>=0;n--){for(c=Array(u),f=e[n],i=u-1;i>=0;i--){for(h=f[a-1]*r[a-1][i],t=a-2;t>=1;t-=2)l=t-1,h+=f[t]*r[t][i]+f[l]*r[l][i];0===t&&(h+=f[0]*r[0][i]),c[i]=h}s[n]=c}return s},numeric._getCol=function(e,r,n){var t,i=e.length;for(t=i-1;t>0;--t)n[t]=e[t][r],--t,n[t]=e[t][r];0===t&&(n[0]=e[0][r])},numeric.dotMMbig=function(e,r){var n,t,i,o,a=numeric._getCol,u=r.length,s=Array(u),c=e.length,f=r[0].length,h=new Array(c),l=numeric.dotVV;for(--u,--c,t=c;t!==-1;--t)h[t]=Array(f);for(--f,t=f;t!==-1;--t)for(a(r,t,s),i=c;i!==-1;--i)o=0,n=e[i],h[i][t]=l(n,s);return h},numeric.dotMV=function(e,r){var n,t=e.length,i=(r.length,Array(t)),o=numeric.dotVV;for(n=t-1;n>=0;n--)i[n]=o(e[n],r);return i},numeric.dotVM=function(e,r){var n,t,i,o,a,u,s;for(i=e.length,o=r[0].length,a=Array(o),t=o-1;t>=0;t--){for(u=e[i-1]*r[i-1][t],n=i-2;n>=1;n-=2)s=n-1,u+=e[n]*r[n][t]+e[s]*r[s][t];0===n&&(u+=e[0]*r[0][t]),a[t]=u}return a},numeric.dotVV=function(e,r){var n,t,i=e.length,o=e[i-1]*r[i-1];for(n=i-2;n>=1;n-=2)t=n-1,o+=e[n]*r[n]+e[t]*r[t];return 0===n&&(o+=e[0]*r[0]),o},numeric.dot=function(e,r){var n=numeric.dim;switch(1e3*n(e).length+n(r).length){case 2002:return r.length<10?numeric.dotMMsmall(e,r):numeric.dotMMbig(e,r);case 2001:return numeric.dotMV(e,r);case 1002:return numeric.dotVM(e,r);case 1001:return numeric.dotVV(e,r);case 1e3:return numeric.mulVS(e,r);case 1:return numeric.mulSV(e,r);case 0:return e*r;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var r,n,t,i,o=e.length,a=Array(o);for(r=o-1;r>=0;r--){for(i=Array(o),n=r+2,t=o-1;t>=n;t-=2)i[t]=0,i[t-1]=0;for(t>r&&(i[t]=0),i[r]=e[r],t=r-1;t>=1;t-=2)i[t]=0,i[t-1]=0;0===t&&(i[0]=0),a[r]=i}return a},numeric.getDiag=function(e){var r,n=Math.min(e.length,e[0].length),t=Array(n);for(r=n-1;r>=1;--r)t[r]=e[r][r],--r,t[r]=e[r][r];return 0===r&&(t[0]=e[0][0]),t},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,r,n){"undefined"==typeof n&&(n="");var t,i,o=[],a=/\[i\]$/,u="",s=!1;for(t=0;t<e.length;t++)a.test(e[t])?(i=e[t].substring(0,e[t].length-3),u=i):i=e[t],"ret"===i&&(s=!0),o.push(i);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+u+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(s?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+r+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,r,n){"undefined"==typeof n&&(n="");var t,i,o=[],a=/\[i\]$/,u="",s=!1;for(t=0;t<e.length;t++)a.test(e[t])?(i=e[t].substring(0,e[t].length-3),u=i):i=e[t],"ret"===i&&(s=!0),o.push(i);return o[e.length]="var _n = "+u+".length;\nvar i"+(s?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+r+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function e(r,n,t,i,o){if(i===t.length-1)return void o(r,n);var a,u=t[i];for(a=u-1;a>=0;a--)e("object"==typeof r?r[a]:r,"object"==typeof n?n[a]:n,t,i+1,o)},numeric._biforeach2=function e(r,n,t,i,o){if(i===t.length-1)return o(r,n);var a,u=t[i],s=Array(u);for(a=u-1;a>=0;--a)s[a]=e("object"==typeof r?r[a]:r,"object"==typeof n?n[a]:n,t,i+1,o);return s},numeric._foreach=function e(r,n,t,i){if(t===n.length-1)return void i(r);var o,a=n[t];for(o=a-1;o>=0;o--)e(r[o],n,t+1,i)},numeric._foreach2=function e(r,n,t,i){if(t===n.length-1)return i(r);var o,a=n[t],u=Array(a);for(o=a-1;o>=0;o--)u[o]=e(r[o],n,t+1,i);return u},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,r;for(e=0;e<numeric.mathfuns2.length;++e)r=numeric.mathfuns2[e],numeric.ops2[r]=r;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){r=numeric.ops2[e];var n,t,i="";numeric.myIndexOf.call(numeric.mathfuns2,e)!==-1?(i="var "+r+" = Math."+r+";\n",n=function(e,n,t){return e+" = "+r+"("+n+","+t+")"},t=function(e,n){return e+" = "+r+"("+e+","+n+")"}):(n=function(e,n,t){return e+" = "+n+" "+r+" "+t},t=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+r+"= "+n}:function(e,n){return e+" = "+e+" "+r+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+t("x","y")+"\n}\nreturn x;\n"),numeric[r]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],t("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],t("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)r=numeric.mathfuns2[e],delete numeric.ops2[r];for(e=0;e<numeric.mathfuns.length;++e)r=numeric.mathfuns[e],numeric.ops1[r]=r;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",r=numeric.ops1[e],numeric.myIndexOf.call(numeric.mathfuns,e)!==-1&&Math.hasOwnProperty(r)&&(i="var "+r+" = Math."+r+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+r+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+r+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+r+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+r+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)r=numeric.mathfuns[e],delete numeric.ops1[r];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(r=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(r[0],r[1]),numeric[e]=Function("x","s","k",r[1]+'if(typeof x !== "object") {    xi = x;\n'+r[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+r[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,r){return"object"==typeof e?"object"==typeof r?numeric.truncVV(e,r):numeric.truncVS(e,r):"object"==typeof r?numeric.truncSV(e,r):Math.round(e/r)*r},numeric.inv=function(e){var r,n,t,i,o,a,u,e,s=numeric.dim(e),c=Math.abs,f=s[0],h=s[1],l=numeric.clone(e),m=numeric.identity(f);for(a=0;a<h;++a){var d=-1,p=-1;for(o=a;o!==f;++o)u=c(l[o][a]),u>p&&(d=o,p=u);for(n=l[d],l[d]=l[a],l[a]=n,i=m[d],m[d]=m[a],m[a]=i,e=n[a],u=a;u!==h;++u)n[u]/=e;for(u=h-1;u!==-1;--u)i[u]/=e;for(o=f-1;o!==-1;--o)if(o!==a){for(r=l[o],t=m[o],e=r[a],u=a+1;u!==h;++u)r[u]-=n[u]*e;for(u=h-1;u>0;--u)t[u]-=i[u]*e,--u,t[u]-=i[u]*e;0===u&&(t[0]-=i[0]*e)}}return m},numeric.det=function(e){var r=numeric.dim(e);if(2!==r.length||r[0]!==r[1])throw new Error("numeric: det() only works on square matrices");var n,t,i,o,a,u,s,c,f=r[0],h=1,l=numeric.clone(e);for(t=0;t<f-1;t++){for(i=t,n=t+1;n<f;n++)Math.abs(l[n][t])>Math.abs(l[i][t])&&(i=n);for(i!==t&&(s=l[i],l[i]=l[t],l[t]=s,h*=-1),o=l[t],n=t+1;n<f;n++){for(a=l[n],u=a[t]/o[t],i=t+1;i<f-1;i+=2)c=i+1,a[i]-=o[i]*u,a[c]-=o[c]*u;i!==f&&(a[i]-=o[i]*u)}if(0===o[t])return 0;h*=o[t]}return h*l[t][t]},numeric.transpose=function(e){var r,n,t,i,o,a=e.length,u=e[0].length,s=Array(u);for(n=0;n<u;n++)s[n]=Array(a);for(r=a-1;r>=1;r-=2){for(i=e[r],t=e[r-1],n=u-1;n>=1;--n)o=s[n],o[r]=i[n],o[r-1]=t[n],--n,o=s[n],o[r]=i[n],o[r-1]=t[n];0===n&&(o=s[0],o[r]=i[0],o[r-1]=t[0])}if(0===r){for(t=e[0],n=u-1;n>=1;--n)s[n][0]=t[n],--n,s[n][0]=t[n];0===n&&(s[0][0]=t[0])}return s},numeric.negtranspose=function(e){var r,n,t,i,o,a=e.length,u=e[0].length,s=Array(u);for(n=0;n<u;n++)s[n]=Array(a);for(r=a-1;r>=1;r-=2){for(i=e[r],t=e[r-1],n=u-1;n>=1;--n)o=s[n],o[r]=-i[n],o[r-1]=-t[n],--n,o=s[n],o[r]=-i[n],o[r-1]=-t[n];0===n&&(o=s[0],o[r]=-i[0],o[r-1]=-t[0])}if(0===r){for(t=e[0],n=u-1;n>=1;--n)s[n][0]=-t[n],--n,s[n][0]=-t[n];0===n&&(s[0][0]=-t[0])}return s},numeric._random=function e(r,n){var t,i,o=r[n],a=Array(o);if(n===r.length-1){for(i=Math.random,t=o-1;t>=1;t-=2)a[t]=i(),a[t-1]=i();return 0===t&&(a[0]=i()),a}for(t=o-1;t>=0;t--)a[t]=e(r,n+1);return a},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,r,n){if("undefined"==typeof n&&(n=Math.max(Math.round(r-e)+1,1)),n<2)return 1===n?[e]:[];var t,i=Array(n);for(n--,t=n;t>=0;t--)i[t]=(t*r+(n-t)*e)/n;return i},numeric.getBlock=function(e,r,n){function t(e,o){var a,u=r[o],s=n[o]-u,c=Array(s);if(o===i.length-1){for(a=s;a>=0;a--)c[a]=e[a+u];return c}for(a=s;a>=0;a--)c[a]=t(e[a+u],o+1);return c}var i=numeric.dim(e);return t(e,0)},numeric.setBlock=function(e,r,n,t){function i(e,t,a){var u,s=r[a],c=n[a]-s;if(a===o.length-1)for(u=c;u>=0;u--)e[u+s]=t[u];for(u=c;u>=0;u--)i(e[u+s],t[u],a+1)}var o=numeric.dim(e);return i(e,t,0),e},numeric.getRange=function(e,r,n){var t,i,o,a,u=r.length,s=n.length,c=Array(u);for(t=u-1;t!==-1;--t)for(c[t]=Array(s),o=c[t],a=e[r[t]],i=s-1;i!==-1;--i)o[i]=a[n[i]];return c},numeric.blockMatrix=function(e){var r=numeric.dim(e);if(r.length<4)return numeric.blockMatrix([e]);var n,t,i,o,a,u=r[0],s=r[1];for(n=0,t=0,i=0;i<u;++i)n+=e[i][0].length;for(o=0;o<s;++o)t+=e[0][o][0].length;var c=Array(n);for(i=0;i<n;++i)c[i]=Array(t);var f,h,l,m,d,p=0;for(i=0;i<u;++i){for(f=t,o=s-1;o!==-1;--o)for(a=e[i][o],f-=a[0].length,l=a.length-1;l!==-1;--l)for(d=a[l],h=c[p+l],m=d.length-1;m!==-1;--m)h[f+m]=d[m];p+=e[i][0].length}return c},numeric.tensor=function(e,r){if("number"==typeof e||"number"==typeof r)return numeric.mul(e,r);var n=numeric.dim(e),t=numeric.dim(r);if(1!==n.length||1!==t.length)throw new Error("numeric: tensor product is only defined for vectors");var i,o,a,u,s=n[0],c=t[0],f=Array(s);for(o=s-1;o>=0;o--){for(i=Array(c),u=e[o],a=c-1;a>=3;--a)i[a]=u*r[a],--a,i[a]=u*r[a],--a,i[a]=u*r[a],--a,i[a]=u*r[a];for(;a>=0;)i[a]=u*r[a],--a;f[o]=i}return f},numeric.T=function(e,r){this.x=e,this.y=r},numeric.t=function(e,r){return new numeric.T(e,r)},numeric.Tbinop=function(e,r,n,t,i){numeric.indexOf;if("string"!=typeof i){var o;i="";for(o in numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||r.indexOf(o)>=0||n.indexOf(o)>=0||t.indexOf(o)>=0)&&o.length>1&&(i+="var "+o+" = numeric."+o+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+t+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+r+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,r=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(r(this.x,n),r(numeric.neg(this.y),n))}return new T(r(1,this.x))},numeric.T.prototype.div=function e(r){if(r instanceof numeric.T||(r=new numeric.T(r)),r.y)return this.mul(r.reciprocal());var e=numeric.div;return this.y?new numeric.T(e(this.x,r.x),e(this.y,r.x)):new numeric.T(e(this.x,r.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,r=this.x,n=this.y;return n?new numeric.T(e(r),e(n)):new numeric.T(e(r))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,r=this.x,n=this.y;return n?new numeric.T(e(r),numeric.negtranspose(n)):new numeric.T(e(r))},numeric.Tunop=function(e,r,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+r+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if("undefined"==typeof e.y)return new numeric.T(numeric.inv(e.x));var r,n,t,i,o,a,u,s,c,f,h,r,n,t,l,m,d,p,v,y,g,x=e.x.length,b=numeric.identity(x),M=numeric.rep([x,x],0),w=numeric.clone(e.x),_=numeric.clone(e.y);for(r=0;r<x;r++){for(d=w[r][r],p=_[r][r],l=d*d+p*p,t=r,n=r+1;n<x;n++)d=w[n][r],p=_[n][r],m=d*d+p*p,m>l&&(t=n,l=m);for(t!==r&&(g=w[r],w[r]=w[t],w[t]=g,g=_[r],_[r]=_[t],_[t]=g,g=b[r],b[r]=b[t],b[t]=g,g=M[r],M[r]=M[t],M[t]=g),i=w[r],o=_[r],s=b[r],c=M[r],d=i[r],p=o[r],n=r+1;n<x;n++)v=i[n],y=o[n],i[n]=(v*d+y*p)/l,o[n]=(y*d-v*p)/l;for(n=0;n<x;n++)v=s[n],y=c[n],s[n]=(v*d+y*p)/l,c[n]=(y*d-v*p)/l;for(n=r+1;n<x;n++){for(a=w[n],u=_[n],f=b[n],h=M[n],d=a[r],p=u[r],t=r+1;t<x;t++)v=i[t],y=o[t],a[t]-=v*d-y*p,u[t]-=y*d+v*p;for(t=0;t<x;t++)v=s[t],y=c[t],f[t]-=v*d-y*p,h[t]-=y*d+v*p}}for(r=x-1;r>0;r--)for(s=b[r],c=M[r],n=r-1;n>=0;n--)for(f=b[n],h=M[n],d=w[n][r],p=_[n][r],t=x-1;t>=0;t--)v=s[t],y=c[t],f[t]-=d*v-p*y,h[t]-=d*y+p*v;return new numeric.T(b,M)},numeric.T.prototype.get=function(e){var r,n=this.x,t=this.y,i=0,o=e.length;if(t){for(;i<o;)r=e[i],n=n[r],t=t[r],i++;return new numeric.T(n,t)}for(;i<o;)r=e[i],n=n[r],i++;return new numeric.T(n)},numeric.T.prototype.set=function(e,r){var n,t=this.x,i=this.y,o=0,a=e.length,u=r.x,s=r.y;if(0===a)return s?this.y=s:i&&(this.y=void 0),this.x=t,this;if(s){for(i||(i=numeric.rep(numeric.dim(t),0),this.y=i);o<a-1;)n=e[o],t=t[n],i=i[n],o++;return n=e[o],t[n]=u,i[n]=s,this}if(i){for(;o<a-1;)n=e[o],t=t[n],i=i[n],o++;return n=e[o],t[n]=u,u instanceof Array?i[n]=numeric.rep(numeric.dim(u),0):i[n]=0,this}for(;o<a-1;)n=e[o],t=t[n],o++;return n=e[o],t[n]=u,this},numeric.T.prototype.getRows=function(e,r){var n,t,i=r-e+1,o=Array(i),a=this.x,u=this.y;for(n=e;n<=r;n++)o[n-e]=a[n];if(u){for(t=Array(i),n=e;n<=r;n++)t[n-e]=u[n];return new numeric.T(o,t)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,r,n){var t,i=this.x,o=this.y,a=n.x,u=n.y;for(t=e;t<=r;t++)i[t]=a[t-e];if(u)for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o),t=e;t<=r;t++)o[t]=u[t-e];else if(o)for(t=e;t<=r;t++)o[t]=numeric.rep([a[t-e].length],0);return this},numeric.T.prototype.getRow=function(e){var r=this.x,n=this.y;return n?new numeric.T(r[e],n[e]):new numeric.T(r[e])},numeric.T.prototype.setRow=function(e,r){var n=this.x,t=this.y,i=r.x,o=r.y;return n[e]=i,o?(t||(t=numeric.rep(numeric.dim(n),0),this.y=t),t[e]=o):t&&(t=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,r){var n=this.x,t=this.y,i=numeric.getBlock;return t?new numeric.T(i(n,e,r),i(t,e,r)):new numeric.T(i(n,e,r))},numeric.T.prototype.setBlock=function(e,r,n){n instanceof numeric.T||(n=new numeric.T(n));var t=this.x,i=this.y,o=numeric.setBlock,a=n.x,u=n.y;return u?(i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(t,e,r,a),o(i,e,r,u),this):(o(t,e,r,a),void(i&&o(i,e,r,numeric.rep(numeric.dim(a),0))))},numeric.T.rep=function(e,r){var n=numeric.T;r instanceof n||(r=new n(r));var t=r.x,i=r.y,o=numeric.rep;return i?new n(o(e,t),o(e,i)):new n(o(e,t))},numeric.T.diag=function e(r){r instanceof numeric.T||(r=new numeric.T(r));var n=r.x,t=r.y,e=numeric.diag;return t?new numeric.T(e(n),e(t)):new numeric.T(e(n))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,r=this.x,n=this.y;return n?new e.T(e.getDiag(r),e.getDiag(n)):new e.T(e.getDiag(r))},numeric.house=function(e){var r=numeric.clone(e),n=e[0]>=0?1:-1,t=n*numeric.norm2(e);r[0]+=t;var i=numeric.norm2(r);if(0===i)throw new Error("eig: internal error");return numeric.div(r,i)},numeric.toUpperHessenberg=function(e){var r=numeric.dim(e);if(2!==r.length||r[0]!==r[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,t,i,o,a,u,s,c,f,h,l=r[0],m=numeric.clone(e),d=numeric.identity(l);for(t=0;t<l-2;t++){for(o=Array(l-t-1),n=t+1;n<l;n++)o[n-t-1]=m[n][t];if(numeric.norm2(o)>0){for(a=numeric.house(o),u=numeric.getBlock(m,[t+1,t],[l-1,l-1]),s=numeric.tensor(a,numeric.dot(a,u)),n=t+1;n<l;n++)for(c=m[n],f=s[n-t-1],i=t;i<l;i++)c[i]-=2*f[i-t];for(u=numeric.getBlock(m,[0,t+1],[l-1,l-1]),s=numeric.tensor(numeric.dot(u,a),a),n=0;n<l;n++)for(c=m[n],f=s[n],i=t+1;i<l;i++)c[i]-=2*f[i-t-1];for(u=Array(l-t-1),n=t+1;n<l;n++)u[n-t-1]=d[n];for(s=numeric.tensor(a,numeric.dot(a,u)),n=t+1;n<l;n++)for(h=d[n],f=s[n-t-1],i=0;i<l;i++)h[i]-=2*f[i]}}return{H:m,Q:d}},numeric.epsilon=2.220446049250313e-16,numeric.QRFrancis=function(e,r){"undefined"==typeof r&&(r=1e4),e=numeric.clone(e);var n,t,i,o,a,u,s,c,f,h,l,m,d,p,v,y,g,x,b=(numeric.clone(e),numeric.dim(e)),M=b[0],w=numeric.identity(M);if(M<3)return{Q:w,B:[[0,M-1]]};var _=numeric.epsilon;for(x=0;x<r;x++){for(y=0;y<M-1;y++)if(Math.abs(e[y+1][y])<_*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){var C=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),r),k=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[M-1,M-1]),r);for(m=Array(y+1),v=0;v<=y;v++)m[v]=w[v];for(d=numeric.dot(C.Q,m),v=0;v<=y;v++)w[v]=d[v];for(m=Array(M-y-1),v=y+1;v<M;v++)m[v-y-1]=w[v];for(d=numeric.dot(k.Q,m),v=y+1;v<M;v++)w[v]=d[v-y-1];return{Q:w,B:C.B.concat(numeric.add(k.B,y+1))}}if(i=e[M-2][M-2],o=e[M-2][M-1],a=e[M-1][M-2],u=e[M-1][M-1],c=i+u,s=i*u-o*a,f=numeric.getBlock(e,[0,0],[2,2]),c*c>=4*s){var A,j;A=.5*(c+Math.sqrt(c*c-4*s)),j=.5*(c-Math.sqrt(c*c-4*s)),f=numeric.add(numeric.sub(numeric.dot(f,f),numeric.mul(f,A+j)),numeric.diag(numeric.rep([3],A*j)))}else f=numeric.add(numeric.sub(numeric.dot(f,f),numeric.mul(f,c)),numeric.diag(numeric.rep([3],s)));for(n=[f[0][0],f[1][0],f[2][0]],t=numeric.house(n),m=[e[0],e[1],e[2]],d=numeric.tensor(t,numeric.dot(t,m)),v=0;v<3;v++)for(l=e[v],p=d[v],g=0;g<M;g++)l[g]-=2*p[g];for(m=numeric.getBlock(e,[0,0],[M-1,2]),d=numeric.tensor(numeric.dot(m,t),t),v=0;v<M;v++)for(l=e[v],p=d[v],g=0;g<3;g++)l[g]-=2*p[g];for(m=[w[0],w[1],w[2]],d=numeric.tensor(t,numeric.dot(t,m)),v=0;v<3;v++)for(h=w[v],p=d[v],g=0;g<M;g++)h[g]-=2*p[g];var S;for(y=0;y<M-2;y++){for(g=y;g<=y+1;g++)if(Math.abs(e[g+1][g])<_*(Math.abs(e[g][g])+Math.abs(e[g+1][g+1]))){var C=numeric.QRFrancis(numeric.getBlock(e,[0,0],[g,g]),r),k=numeric.QRFrancis(numeric.getBlock(e,[g+1,g+1],[M-1,M-1]),r);for(m=Array(g+1),v=0;v<=g;v++)m[v]=w[v];for(d=numeric.dot(C.Q,m),v=0;v<=g;v++)w[v]=d[v];for(m=Array(M-g-1),v=g+1;v<M;v++)m[v-g-1]=w[v];for(d=numeric.dot(k.Q,m),v=g+1;v<M;v++)w[v]=d[v-g-1];return{Q:w,B:C.B.concat(numeric.add(k.B,g+1))}}for(S=Math.min(M-1,y+3),n=Array(S-y),v=y+1;v<=S;v++)n[v-y-1]=e[v][y];for(t=numeric.house(n),m=numeric.getBlock(e,[y+1,y],[S,M-1]),d=numeric.tensor(t,numeric.dot(t,m)),v=y+1;v<=S;v++)for(l=e[v],p=d[v-y-1],g=y;g<M;g++)l[g]-=2*p[g-y];for(m=numeric.getBlock(e,[0,y+1],[M-1,S]),d=numeric.tensor(numeric.dot(m,t),t),v=0;v<M;v++)for(l=e[v],p=d[v],g=y+1;g<=S;g++)l[g]-=2*p[g-y-1];for(m=Array(S-y),v=y+1;v<=S;v++)m[v-y-1]=w[v];for(d=numeric.tensor(t,numeric.dot(t,m)),v=y+1;v<=S;v++)for(h=w[v],p=d[v-y-1],g=0;g<M;g++)h[g]-=2*p[g]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,r){var n,t,i,o,a,u,s,c,f,h,l,m,d,p,v,y,g,x=numeric.toUpperHessenberg(e),b=numeric.QRFrancis(x.H,r),M=numeric.T,w=e.length,_=b.B,C=numeric.dot(b.Q,numeric.dot(x.H,numeric.transpose(b.Q))),k=new M(numeric.dot(b.Q,x.Q)),A=_.length,j=Math.sqrt;for(t=0;t<A;t++)if(n=_[t][0],n===_[t][1]);else{if(o=n+1,a=C[n][n],u=C[n][o],s=C[o][n],c=C[o][o],0===u&&0===s)continue;f=-a-c,h=a*c-u*s,l=f*f-4*h,l>=0?(m=f<0?-.5*(f-j(l)):-.5*(f+j(l)),y=(a-m)*(a-m)+u*u,g=s*s+(c-m)*(c-m),y>g?(y=j(y),p=(a-m)/y,v=u/y):(g=j(g),p=s/g,v=(c-m)/g),i=new M([[v,-p],[p,v]]),k.setRows(n,o,i.dot(k.getRows(n,o)))):(m=-.5*f,d=.5*j(-l),y=(a-m)*(a-m)+u*u,g=s*s+(c-m)*(c-m),y>g?(y=j(y+d*d),p=(a-m)/y,v=u/y,m=0,d/=y):(g=j(g+d*d),p=s/g,v=(c-m)/g,m=d/g,d=0),i=new M([[v,-p],[p,v]],[[m,d],[d,-m]]),k.setRows(n,o,i.dot(k.getRows(n,o))))}var S=k.dot(e).dot(k.transjugate()),w=e.length,T=numeric.T.identity(w);for(o=0;o<w;o++)if(o>0)for(t=o-1;t>=0;t--){var P=S.get([t,t]),O=S.get([o,o]);numeric.neq(P.x,O.x)||numeric.neq(P.y,O.y)?(m=S.getRow(t).getBlock([t],[o-1]),d=T.getRow(o).getBlock([t],[o-1]),T.set([o,t],S.get([t,o]).neg().sub(m.dot(d)).div(P.sub(O)))):T.setRow(o,T.getRow(t))}for(o=0;o<w;o++)m=T.getRow(o),T.setRow(o,m.div(m.norm2()));return T=T.transpose(),T=k.transjugate().dot(T),{lambda:S.getDiag(),E:T}},numeric.ccsSparse=function(e){var r,n,t,i,o=e.length,a=[];for(t=o-1;t!==-1;--t){n=e[t];for(i in n){for(i=parseInt(i);i>=a.length;)a[a.length]=0;0!==n[i]&&a[i]++}}var r=a.length,u=Array(r+1);for(u[0]=0,t=0;t<r;++t)u[t+1]=u[t]+a[t];var s=Array(u[r]),c=Array(u[r]);for(t=o-1;t!==-1;--t){n=e[t];for(i in n)0!==n[i]&&(a[i]--,s[u[i]+a[i]]=t,c[u[i]+a[i]]=n[i])}return[u,s,c]},numeric.ccsFull=function(e){var r,n,t,i,o=e[0],a=e[1],u=e[2],s=numeric.ccsDim(e),c=s[0],f=s[1],h=numeric.rep([c,f],0);for(r=0;r<f;r++)for(t=o[r],i=o[r+1],n=t;n<i;++n)h[a[n]][r]=u[n];return h},numeric.ccsTSolve=function(e,r,n,t,i){function o(e){var r;if(0===n[e]){for(n[e]=1,r=a[e];r<a[e+1];++r)o(u[r]);i[h]=e,++h}}var a=e[0],u=e[1],s=e[2],c=a.length-1,f=Math.max,h=0;"undefined"==typeof t&&(n=numeric.rep([c],0)),"undefined"==typeof t&&(t=numeric.linspace(0,n.length-1)),"undefined"==typeof i&&(i=[]);var l,m,d,p,v,y,g;for(l=t.length-1;l!==-1;--l)o(t[l]);for(i.length=h,l=i.length-1;l!==-1;--l)n[i[l]]=0;for(l=t.length-1;l!==-1;--l)m=t[l],n[m]=r[m];for(l=i.length-1;l!==-1;--l){for(m=i[l],d=a[m],p=f(a[m+1],d),v=d;v!==p;++v)if(u[v]===m){n[m]/=s[v];break}for(g=n[m],v=d;v!==p;++v)y=u[v],y!==m&&(n[y]-=g*s[v])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,r,n,t,i,o){var a,u,s,c=0,f=i.length,h=this.k,l=this.k1,m=this.j;if(0===t[e])for(t[e]=1,m[0]=e,h[0]=u=r[e],l[0]=s=r[e+1];;)if(u>=s){if(i[f]=m[c],0===c)return;++f,--c,u=h[c],s=l[c];
}else a=o[n[u]],0===t[a]?(t[a]=1,h[c]=u,++c,m[c]=a,u=r[a],l[c]=s=r[a+1]):++u},numeric.ccsLPSolve=function(e,r,n,t,i,o,a){var u,s,c,f,h,l,m,d,p,v=e[0],y=e[1],g=e[2],x=(v.length-1,r[0]),b=r[1],M=r[2];for(s=x[i],c=x[i+1],t.length=0,u=s;u<c;++u)a.dfs(o[b[u]],v,y,n,t,o);for(u=t.length-1;u!==-1;--u)n[t[u]]=0;for(u=s;u!==c;++u)f=o[b[u]],n[f]=M[u];for(u=t.length-1;u!==-1;--u){for(f=t[u],h=v[f],l=v[f+1],m=h;m<l;++m)if(o[y[m]]===f){n[f]/=g[m];break}for(p=n[f],m=h;m<l;++m)d=o[y[m]],d!==f&&(n[d]-=p*g[m])}return n},numeric.ccsLUP1=function(e,r){var n,t,i,o,a,u,s,c=e[0].length-1,f=[numeric.rep([c+1],0),[],[]],h=[numeric.rep([c+1],0),[],[]],l=f[0],m=f[1],d=f[2],p=h[0],v=h[1],y=h[2],g=numeric.rep([c],0),x=numeric.rep([c],0),b=numeric.ccsLPSolve,M=(Math.max,Math.abs),w=numeric.linspace(0,c-1),_=numeric.linspace(0,c-1),C=new numeric.ccsDFS(c);for("undefined"==typeof r&&(r=1),n=0;n<c;++n){for(b(f,e,g,x,n,_,C),o=-1,a=-1,t=x.length-1;t!==-1;--t)i=x[t],i<=n||(u=M(g[i]),u>o&&(a=i,o=u));for(M(g[n])<r*o&&(t=w[n],o=w[a],w[n]=o,_[o]=n,w[a]=t,_[t]=a,o=g[n],g[n]=g[a],g[a]=o),o=l[n],a=p[n],s=g[n],m[o]=w[n],d[o]=1,++o,t=x.length-1;t!==-1;--t)i=x[t],u=g[i],x[t]=0,g[i]=0,i<=n?(v[a]=i,y[a]=u,++a):(m[o]=w[i],d[o]=u/s,++o);l[n+1]=o,p[n+1]=a}for(t=m.length-1;t!==-1;--t)m[t]=_[m[t]];return{L:f,U:h,P:w,Pinv:_}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,r,n,t,i,o,a){var u,s,c,f=0,h=i.length,l=this.k,m=this.k1,d=this.j;if(0===t[e])for(t[e]=1,d[0]=e,l[0]=s=r[o[e]],m[0]=c=r[o[e]+1];;){if(isNaN(s))throw new Error("Ow!");if(s>=c){if(i[h]=o[d[f]],0===f)return;++h,--f,s=l[f],c=m[f]}else u=n[s],0===t[u]?(t[u]=1,l[f]=s,++f,d[f]=u,u=o[u],s=r[u],m[f]=c=r[u+1]):++s}},numeric.ccsLPSolve0=function(e,r,n,t,i,o,a,u){var s,c,f,h,l,m,d,p,v,y=e[0],g=e[1],x=e[2],b=(y.length-1,r[0]),M=r[1],w=r[2];for(c=b[i],f=b[i+1],t.length=0,s=c;s<f;++s)u.dfs(M[s],y,g,n,t,o,a);for(s=t.length-1;s!==-1;--s)h=t[s],n[a[h]]=0;for(s=c;s!==f;++s)h=M[s],n[h]=w[s];for(s=t.length-1;s!==-1;--s){for(h=t[s],p=a[h],l=y[h],m=y[h+1],d=l;d<m;++d)if(g[d]===p){n[p]/=x[d];break}for(v=n[p],d=l;d<m;++d)n[g[d]]-=v*x[d];n[p]=v}},numeric.ccsLUP0=function(e,r){var n,t,i,o,a,u,s,c=e[0].length-1,f=[numeric.rep([c+1],0),[],[]],h=[numeric.rep([c+1],0),[],[]],l=f[0],m=f[1],d=f[2],p=h[0],v=h[1],y=h[2],g=numeric.rep([c],0),x=numeric.rep([c],0),b=numeric.ccsLPSolve0,M=(Math.max,Math.abs),w=numeric.linspace(0,c-1),_=numeric.linspace(0,c-1),C=new numeric.ccsDFS0(c);for("undefined"==typeof r&&(r=1),n=0;n<c;++n){for(b(f,e,g,x,n,_,w,C),o=-1,a=-1,t=x.length-1;t!==-1;--t)i=x[t],i<=n||(u=M(g[w[i]]),u>o&&(a=i,o=u));for(M(g[w[n]])<r*o&&(t=w[n],o=w[a],w[n]=o,_[o]=n,w[a]=t,_[t]=a),o=l[n],a=p[n],s=g[w[n]],m[o]=w[n],d[o]=1,++o,t=x.length-1;t!==-1;--t)i=x[t],u=g[w[i]],x[t]=0,g[w[i]]=0,i<=n?(v[a]=i,y[a]=u,++a):(m[o]=w[i],d[o]=u/s,++o);l[n+1]=o,p[n+1]=a}for(t=m.length-1;t!==-1;--t)m[t]=_[m[t]];return{L:f,U:h,P:w,Pinv:_}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,r,n){var t=numeric.ccsDim(e),i=t[0],o=t[1];"undefined"==typeof r?r=numeric.linspace(0,i-1):"number"==typeof r&&(r=[r]),"undefined"==typeof n?n=numeric.linspace(0,o-1):"number"==typeof n&&(n=[n]);var a,u,s,c,f,h=r.length,l=n.length,m=numeric.rep([o],0),d=[],p=[],v=[m,d,p],y=e[0],g=e[1],x=e[2],b=numeric.rep([i],0),M=0,w=numeric.rep([i],0);for(u=0;u<l;++u){c=n[u];var _=y[c],C=y[c+1];for(a=_;a<C;++a)s=g[a],w[s]=1,b[s]=x[a];for(a=0;a<h;++a)f=r[a],w[f]&&(d[M]=a,p[M]=b[r[a]],++M);for(a=_;a<C;++a)s=g[a],w[s]=0;m[u+1]=M}return v},numeric.ccsDot=function(e,r){var n,t,i,o,a,u,s,c,f,h,l,m=e[0],d=e[1],p=e[2],v=r[0],y=r[1],g=r[2],x=numeric.ccsDim(e),b=numeric.ccsDim(r),M=x[0],w=(x[1],b[1]),_=numeric.rep([M],0),C=numeric.rep([M],0),k=Array(M),A=numeric.rep([w],0),j=[],S=[],T=[A,j,S];for(i=0;i!==w;++i){for(o=v[i],a=v[i+1],f=0,t=o;t<a;++t)for(h=y[t],l=g[t],u=m[h],s=m[h+1],n=u;n<s;++n)c=d[n],0===C[c]&&(k[f]=c,C[c]=1,f+=1),_[c]=_[c]+p[n]*l;for(o=A[i],a=o+f,A[i+1]=a,t=f-1;t!==-1;--t)l=o+t,n=k[t],j[l]=n,S[l]=_[n],C[n]=0,_[n]=0;A[i+1]=A[i]+f}return T},numeric.ccsLUPSolve=function(e,r){var n=e.L,t=e.U,i=(e.P,r[0]),o=!1;"object"!=typeof i&&(r=[[0,r.length],numeric.linspace(0,r.length-1),r],i=r[0],o=!0);var a,u,s,c,f,h,l=r[1],m=r[2],d=n[0].length-1,p=i.length-1,v=numeric.rep([d],0),y=Array(d),g=numeric.rep([d],0),x=Array(d),b=numeric.rep([p+1],0),M=[],w=[],_=numeric.ccsTSolve,C=0;for(a=0;a<p;++a){for(f=0,s=i[a],c=i[a+1],u=s;u<c;++u)h=e.Pinv[l[u]],x[f]=h,g[h]=m[u],++f;for(x.length=f,_(n,g,v,x,y),u=x.length-1;u!==-1;--u)g[x[u]]=0;if(_(t,v,g,y,x),o)return g;for(u=y.length-1;u!==-1;--u)v[y[u]]=0;for(u=x.length-1;u!==-1;--u)h=x[u],M[C]=h,w[C]=g[h],g[h]=0,++C;b[a+1]=C}return[b,M,w]},numeric.ccsbinop=function(e,r){return"undefined"==typeof r&&(r=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+r+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var r,n=e[0],t=e[1],i=e[2],o=numeric.sup(t)+1,a=n.length,u=numeric.rep([o],0),s=Array(a),c=Array(a),f=numeric.rep([o],0);for(r=0;r<a;++r)f[t[r]]++;for(r=0;r<o;++r)u[r+1]=u[r]+f[r];var h,l,m=u.slice(0);for(r=0;r<a;++r)l=t[r],h=m[l],s[h]=n[r],c[h]=i[r],m[l]=m[l]+1;return[u,s,c]},numeric.ccsGather=function(e){var r,n,t,i,o,a=e[0],u=e[1],s=e[2],c=a.length-1,f=u.length,h=Array(f),l=Array(f),m=Array(f);for(o=0,r=0;r<c;++r)for(t=a[r],i=a[r+1],n=t;n!==i;++n)l[o]=r,h[o]=u[n],m[o]=s[n],++o;return[h,l,m]},numeric.sdim=function e(r,n,t){if("undefined"==typeof n&&(n=[]),"object"!=typeof r)return n;"undefined"==typeof t&&(t=0),t in n||(n[t]=0),r.length>n[t]&&(n[t]=r.length);var i;for(i in r)r.hasOwnProperty(i)&&e(r[i],n,t+1);return n},numeric.sclone=function e(r,n,t){"undefined"==typeof n&&(n=0),"undefined"==typeof t&&(t=numeric.sdim(r).length);var i,o=Array(r.length);if(n===t-1){for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);return o}for(i in r)r.hasOwnProperty(i)&&(o[i]=e(r[i],n+1,t));return o},numeric.sdiag=function(e){var r,n,t=e.length,i=Array(t);for(r=t-1;r>=1;r-=2)n=r-1,i[r]=[],i[r][r]=e[r],i[n]=[],i[n][n]=e[n];return 0===r&&(i[0]=[],i[0][0]=e[r]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var r,n,t,i=[];e.length;for(r in e)if(e.hasOwnProperty(r)){t=e[r];for(n in t)t.hasOwnProperty(n)&&("object"!=typeof i[n]&&(i[n]=[]),i[n][r]=t[n])}return i},numeric.sLUP=function(e,r){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,r){var n,t,i,o,a,u,s,c=e.length,f=(r.length,numeric.stranspose(r)),h=f.length,l=Array(c);for(i=c-1;i>=0;i--){for(s=[],n=e[i],a=h-1;a>=0;a--){u=0,t=f[a];for(o in n)n.hasOwnProperty(o)&&o in t&&(u+=n[o]*t[o]);u&&(s[a]=u)}l[i]=s}return l},numeric.sdotMV=function(e,r){var n,t,i,o,a=e.length,u=Array(a);for(t=a-1;t>=0;t--){n=e[t],o=0;for(i in n)n.hasOwnProperty(i)&&r[i]&&(o+=n[i]*r[i]);o&&(u[t]=o)}return u},numeric.sdotVM=function(e,r){var n,t,i,o,a=[];for(n in e)if(e.hasOwnProperty(n)){i=r[n],o=e[n];for(t in i)i.hasOwnProperty(t)&&(a[t]||(a[t]=0),a[t]+=o*i[t])}return a},numeric.sdotVV=function(e,r){var n,t=0;for(n in e)e[n]&&r[n]&&(t+=e[n]*r[n]);return t},numeric.sdot=function(e,r){var n=numeric.sdim(e).length,t=numeric.sdim(r).length,i=1e3*n+t;switch(i){case 0:return e*r;case 1001:return numeric.sdotVV(e,r);case 2001:return numeric.sdotMV(e,r);case 1002:return numeric.sdotVM(e,r);case 2002:return numeric.sdotMM(e,r);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+t)}},numeric.sscatter=function(e){var r,n,t,i,o=e[0].length,a=e.length,u=[];for(n=o-1;n>=0;--n)if(e[a-1][n]){for(i=u,t=0;t<a-2;t++)r=e[t][n],i[r]||(i[r]=[]),i=i[r];i[e[t][n]]=e[t+1][n]}return u},numeric.sgather=function e(r,n,t){"undefined"==typeof n&&(n=[]),"undefined"==typeof t&&(t=[]);var i,o,a;i=t.length;for(o in r)if(r.hasOwnProperty(o))if(t[i]=parseInt(o),a=r[o],"number"==typeof a){if(a){if(0===n.length)for(o=i+1;o>=0;--o)n[o]=[];for(o=i;o>=0;--o)n[o].push(t[o]);n[i+1].push(a)}}else e(a,n,t);return t.length>i&&t.pop(),n},numeric.cLU=function(e){var r,n,t,i,o,a,u=e[0],s=e[1],c=e[2],f=u.length,h=0;for(r=0;r<f;r++)u[r]>h&&(h=u[r]);h++;var l,m,d,p=Array(h),v=Array(h),y=numeric.rep([h],1/0),g=numeric.rep([h],-(1/0));for(t=0;t<f;t++)r=u[t],n=s[t],n<y[r]&&(y[r]=n),n>g[r]&&(g[r]=n);for(r=0;r<h-1;r++)g[r]>g[r+1]&&(g[r+1]=g[r]);for(r=h-1;r>=1;r--)y[r]<y[r-1]&&(y[r-1]=y[r]);var x=0,b=0;for(r=0;r<h;r++)v[r]=numeric.rep([g[r]-y[r]+1],0),p[r]=numeric.rep([r-y[r]],0),x+=r-y[r]+1,b+=g[r]-r+1;for(t=0;t<f;t++)r=u[t],v[r][s[t]-y[r]]=c[t];for(r=0;r<h-1;r++)for(i=r-y[r],l=v[r],n=r+1;y[n]<=r&&n<h;n++)if(o=r-y[n],a=g[r]-r,m=v[n],d=m[o]/l[i]){for(t=1;t<=a;t++)m[t+o]-=d*l[t+i];p[n][r-y[n]]=d}var f,M,w,l=[],m=[],_=[],C=[],k=[],A=[];for(f=0,M=0,r=0;r<h;r++){for(i=y[r],o=g[r],w=v[r],n=r;n<=o;n++)w[n-i]&&(l[f]=r,m[f]=n,_[f]=w[n-i],f++);for(w=p[r],n=i;n<r;n++)w[n-i]&&(C[M]=r,k[M]=n,A[M]=w[n-i],M++);C[M]=r,k[M]=r,A[M]=1,M++}return{U:[l,m,_],L:[C,k,A]}},numeric.cLUsolve=function(e,r){var n,t,i=e.L,o=e.U,a=numeric.clone(r),u=i[0],s=i[1],c=i[2],f=o[0],h=o[1],l=o[2],m=f.length,d=(u.length,a.length);for(t=0,n=0;n<d;n++){for(;s[t]<n;)a[n]-=c[t]*a[s[t]],t++;t++}for(t=m-1,n=d-1;n>=0;n--){for(;h[t]>n;)a[n]-=l[t]*a[h[t]],t--;a[n]/=l[t],t--}return a},numeric.cgrid=function(e,r){"number"==typeof e&&(e=[e,e]);var n,t,i,o=numeric.rep(e,-1);if("function"!=typeof r)switch(r){case"L":r=function(r,n){return r>=e[0]/2||n<e[1]/2};break;default:r=function(e,r){return!0}}for(i=0,n=1;n<e[0]-1;n++)for(t=1;t<e[1]-1;t++)r(n,t)&&(o[n][t]=i,i++);return o},numeric.cdelsq=function(e){var r,n,t,i,o,a=[[-1,0],[0,-1],[0,1],[1,0]],u=numeric.dim(e),s=u[0],c=u[1],f=[],h=[],l=[];for(r=1;r<s-1;r++)for(n=1;n<c-1;n++)if(!(e[r][n]<0)){for(t=0;t<4;t++)i=r+a[t][0],o=n+a[t][1],e[i][o]<0||(f.push(e[r][n]),h.push(e[i][o]),l.push(-1));f.push(e[r][n]),h.push(e[r][n]),l.push(4)}return[f,h,l]},numeric.cdotMV=function(e,r){var n,t,i,o=e[0],a=e[1],u=e[2],s=o.length;for(i=0,t=0;t<s;t++)o[t]>i&&(i=o[t]);for(i++,n=numeric.rep([i],0),t=0;t<s;t++)n[o[t]]+=u[t]*r[a[t]];return n},numeric.Spline=function(e,r,n,t,i){this.x=e,this.yl=r,this.yr=n,this.kl=t,this.kr=i},numeric.Spline.prototype._at=function(e,r){var e,n,t,i,o=this.x,a=this.yl,u=this.yr,s=this.kl,c=this.kr,f=numeric.add,h=numeric.sub,l=numeric.mul;n=h(l(s[r],o[r+1]-o[r]),h(u[r+1],a[r])),t=f(l(c[r+1],o[r]-o[r+1]),h(u[r+1],a[r])),i=(e-o[r])/(o[r+1]-o[r]);var m=i*(1-i);return f(f(f(l(1-i,a[r]),l(i,u[r+1])),l(n,m*(1-i))),l(t,m*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var r,n,t,i=this.x,o=i.length,a=Math.floor;for(r=0,n=o-1;n-r>1;)t=a((r+n)/2),i[t]<=e?r=t:n=t;return this._at(e,r)}var u,o=e.length,s=Array(o);for(u=o-1;u!==-1;--u)s[u]=this.at(e[u]);return s},numeric.Spline.prototype.diff=function(){var e,r,n,t=this.x,i=this.yl,o=this.yr,a=this.kl,u=this.kr,s=i.length,c=a,f=u,h=Array(s),l=Array(s),m=numeric.add,d=numeric.mul,p=numeric.div,v=numeric.sub;for(e=s-1;e!==-1;--e)r=t[e+1]-t[e],n=v(o[e+1],i[e]),h[e]=p(m(d(n,6),d(a[e],-4*r),d(u[e+1],-2*r)),r*r),l[e+1]=p(m(d(n,-6),d(a[e],2*r),d(u[e+1],4*r)),r*r);return new numeric.Spline(t,c,f,h,l)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var r=[],n=this.x,t=this.yl,i=this.yr,o=this.kl,a=this.kr;"number"==typeof t[0]&&(t=[t],i=[i],o=[o],a=[a]);var u,s,c,f,h,l,m,d,p,v,y,g,x,b,M,w,_,C,k,A,j,S,T,P,O=t.length,N=n.length-1,r=Array(O),q=Math.sqrt;for(u=0;u!==O;++u){for(f=t[u],h=i[u],l=o[u],m=a[u],d=[],s=0;s!==N;s++){for(s>0&&h[s]*f[s]<0&&d.push(n[s]),w=n[s+1]-n[s],_=n[s],y=f[s],g=h[s+1],p=l[s]/w,v=m[s+1]/w,M=e(p-v+3*(y-g))+12*v*y,x=v+3*y+2*p-3*g,b=3*(v+p+2*(y-g)),M<=0?(k=x/b,C=k>n[s]&&k<n[s+1]?[n[s],k,n[s+1]]:[n[s],n[s+1]]):(k=(x-q(M))/b,A=(x+q(M))/b,C=[n[s]],k>n[s]&&k<n[s+1]&&C.push(k),A>n[s]&&A<n[s+1]&&C.push(A),C.push(n[s+1])),S=C[0],k=this._at(S,s),c=0;c<C.length-1;c++)if(T=C[c+1],A=this._at(T,s),0!==k)if(0===A||k*A>0)S=T,k=A;else{for(var F=0;;){if(P=(k*T-A*S)/(k-A),P<=S||P>=T)break;if(j=this._at(P,s),j*A>0)T=P,A=j,F===-1&&(k*=.5),F=-1;else{if(!(j*k>0))break;S=P,k=j,1===F&&(A*=.5),F=1}}d.push(P),S=C[c+1],k=this._at(S,s)}else d.push(S),S=T,k=A;0===A&&d.push(T)}r[u]=d}return"number"==typeof this.yl[0]?r[0]:r},numeric.spline=function(e,r,n,t){var i,o=e.length,a=[],u=[],s=[],c=numeric.sub,f=numeric.mul,h=numeric.add;for(i=o-2;i>=0;i--)u[i]=e[i+1]-e[i],s[i]=c(r[i+1],r[i]);"string"!=typeof n&&"string"!=typeof t||(n=t="periodic");var l=[[],[],[]];switch(typeof n){case"undefined":a[0]=f(3/(u[0]*u[0]),s[0]),l[0].push(0,0),l[1].push(0,1),l[2].push(2/u[0],1/u[0]);break;case"string":a[0]=h(f(3/(u[o-2]*u[o-2]),s[o-2]),f(3/(u[0]*u[0]),s[0])),l[0].push(0,0,0),l[1].push(o-2,0,1),l[2].push(1/u[o-2],2/u[o-2]+2/u[0],1/u[0]);break;default:a[0]=n,l[0].push(0),l[1].push(0),l[2].push(1)}for(i=1;i<o-1;i++)a[i]=h(f(3/(u[i-1]*u[i-1]),s[i-1]),f(3/(u[i]*u[i]),s[i])),l[0].push(i,i,i),l[1].push(i-1,i,i+1),l[2].push(1/u[i-1],2/u[i-1]+2/u[i],1/u[i]);switch(typeof t){case"undefined":a[o-1]=f(3/(u[o-2]*u[o-2]),s[o-2]),l[0].push(o-1,o-1),l[1].push(o-2,o-1),l[2].push(1/u[o-2],2/u[o-2]);break;case"string":l[1][l[1].length-1]=0;break;default:a[o-1]=t,l[0].push(o-1),l[1].push(o-1),l[2].push(1)}a="number"!=typeof a[0]?numeric.transpose(a):[a];var m=Array(a.length);if("string"==typeof n)for(i=m.length-1;i!==-1;--i)m[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(l)),a[i]),m[i][o-1]=m[i][0];else for(i=m.length-1;i!==-1;--i)m[i]=numeric.cLUsolve(numeric.cLU(l),a[i]);return m="number"==typeof r[0]?m[0]:numeric.transpose(m),new numeric.Spline(e,r,r,m,m)},numeric.fftpow2=function e(r,n){var t=r.length;if(1!==t){var i,o,a=Math.cos,u=Math.sin,s=Array(t/2),c=Array(t/2),f=Array(t/2),h=Array(t/2);for(o=t/2,i=t-1;i!==-1;--i)--o,f[o]=r[i],h[o]=n[i],--i,s[o]=r[i],c[o]=n[i];e(s,c),e(f,h),o=t/2;var l,m,d,p=-6.283185307179586/t;for(i=t-1;i!==-1;--i)--o,o===-1&&(o=t/2-1),l=p*i,m=a(l),d=u(l),r[i]=s[o]+m*f[o]-d*h[o],n[i]=c[o]+m*h[o]+d*f[o]}},numeric._ifftpow2=function e(r,n){var t=r.length;if(1!==t){var i,o,a=Math.cos,u=Math.sin,s=Array(t/2),c=Array(t/2),f=Array(t/2),h=Array(t/2);for(o=t/2,i=t-1;i!==-1;--i)--o,f[o]=r[i],h[o]=n[i],--i,s[o]=r[i],c[o]=n[i];e(s,c),e(f,h),o=t/2;var l,m,d,p=6.283185307179586/t;for(i=t-1;i!==-1;--i)--o,o===-1&&(o=t/2-1),l=p*i,m=a(l),d=u(l),r[i]=s[o]+m*f[o]-d*h[o],n[i]=c[o]+m*h[o]+d*f[o]}},numeric.ifftpow2=function(e,r){numeric._ifftpow2(e,r),numeric.diveq(e,e.length),numeric.diveq(r,r.length)},numeric.convpow2=function(e,r,n,t){numeric.fftpow2(e,r),numeric.fftpow2(n,t);var i,o,a,u,s,c=e.length;for(i=c-1;i!==-1;--i)o=e[i],u=r[i],a=n[i],s=t[i],e[i]=o*a-u*s,r[i]=o*s+u*a;numeric.ifftpow2(e,r)},numeric.T.prototype.fft=function(){var e,r,n=this.x,t=this.y,i=n.length,o=Math.log,a=o(2),u=Math.ceil(o(2*i-1)/a),s=Math.pow(2,u),c=numeric.rep([s],0),f=numeric.rep([s],0),h=Math.cos,l=Math.sin,m=-3.141592653589793/i,d=numeric.rep([s],0),p=numeric.rep([s],0);Math.floor(i/2);for(e=0;e<i;e++)d[e]=n[e];if("undefined"!=typeof t)for(e=0;e<i;e++)p[e]=t[e];for(c[0]=1,e=1;e<=s/2;e++)r=m*e*e,c[e]=h(r),f[e]=l(r),c[s-e]=h(r),f[s-e]=l(r);var v=new numeric.T(d,p),y=new numeric.T(c,f);return v=v.mul(y),numeric.convpow2(v.x,v.y,numeric.clone(y.x),numeric.neg(y.y)),v=v.mul(y),v.x.length=i,v.y.length=i,v},numeric.T.prototype.ifft=function(){var e,r,n=this.x,t=this.y,i=n.length,o=Math.log,a=o(2),u=Math.ceil(o(2*i-1)/a),s=Math.pow(2,u),c=numeric.rep([s],0),f=numeric.rep([s],0),h=Math.cos,l=Math.sin,m=3.141592653589793/i,d=numeric.rep([s],0),p=numeric.rep([s],0);Math.floor(i/2);for(e=0;e<i;e++)d[e]=n[e];if("undefined"!=typeof t)for(e=0;e<i;e++)p[e]=t[e];for(c[0]=1,e=1;e<=s/2;e++)r=m*e*e,c[e]=h(r),f[e]=l(r),c[s-e]=h(r),f[s-e]=l(r);var v=new numeric.T(d,p),y=new numeric.T(c,f);return v=v.mul(y),numeric.convpow2(v.x,v.y,numeric.clone(y.x),numeric.neg(y.y)),v=v.mul(y),v.x.length=i,v.y.length=i,v.div(i)},numeric.gradient=function(e,r){var n=r.length,t=e(r);if(isNaN(t))throw new Error("gradient: f(x) is a NaN!");var i,o,a,u,s,c,f,h,l,m,d=Math.max,p=numeric.clone(r),v=Array(n),d=(numeric.div,numeric.sub,Math.max),y=.001,g=Math.abs,x=Math.min,b=0;for(i=0;i<n;i++)for(var M=d(1e-6*t,1e-8);;){if(++b,b>20)throw new Error("Numerical gradient fails");if(p[i]=r[i]+M,o=e(p),p[i]=r[i]-M,a=e(p),p[i]=r[i],isNaN(o)||isNaN(a))M/=16;else{if(v[i]=(o-a)/(2*M),s=r[i]-M,c=r[i],f=r[i]+M,h=(o-t)/M,l=(t-a)/M,m=d(g(v[i]),g(t),g(o),g(a),g(s),g(c),g(f),1e-8),u=x(d(g(h-v[i]),g(l-v[i]),g(h-l))/m,M/m),!(u>y))break;M/=16}}return v},numeric.uncmin=function(e,r,n,t,i,o,a){var u=numeric.gradient;"undefined"==typeof a&&(a={}),"undefined"==typeof n&&(n=1e-8),"undefined"==typeof t&&(t=function(r){return u(e,r)}),"undefined"==typeof i&&(i=1e3),r=numeric.clone(r);var s,c,f=r.length,h=e(r);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var l=Math.max,m=numeric.norm2;n=l(n,numeric.epsilon);var d,p,v,y,g,x,b,M,w,_,C=a.Hinv||numeric.identity(f),k=numeric.dot,A=(numeric.inv,numeric.sub),j=numeric.add,S=numeric.tensor,T=numeric.div,P=numeric.mul,O=numeric.all,N=numeric.isFinite,q=numeric.neg,F=0,B="";for(p=t(r);F<i;){if("function"==typeof o&&o(F,r,h,p,C)){B="Callback returned true";break}if(!O(N(p))){B="Gradient has Infinity or NaN";break}if(d=q(k(C,p)),!O(N(d))){B="Search direction has Infinity or NaN";break}if(_=m(d),_<n){B="Newton step smaller than tol";break}for(w=1,c=k(p,d),g=r;F<i&&!(w*_<n)&&(y=P(d,w),g=j(r,y),s=e(g),s-h>=.1*w*c||isNaN(s));)w*=.5,++F;if(w*_<n){B="Line search step size smaller than tol";break}if(F===i){B="maxit reached during line search";break}v=t(g),x=A(v,p),M=k(x,y),b=k(C,x),C=A(j(C,P((M+k(x,b))/(M*M),S(y,y))),T(j(S(b,y),S(y,b)),M)),r=g,h=s,p=v,++F}return{solution:r,f:h,gradient:p,invHessian:C,iterations:F,message:B}},numeric.Dopri=function(e,r,n,t,i,o,a){this.x=e,this.y=r,this.f=n,this.ymid=t,this.iterations=i,this.events=a,this.message=o},numeric.Dopri.prototype._at=function(e,r){function n(e){return e*e}var t,i,o,a,u,s,e,c,f,h,l,m=this,d=m.x,p=m.y,v=m.f,y=m.ymid,g=(d.length,Math.floor,.5),x=numeric.add,b=numeric.mul,M=numeric.sub;return t=d[r],i=d[r+1],a=p[r],u=p[r+1],c=i-t,o=t+g*c,s=y[r],f=M(v[r],b(a,1/(t-o)+2/(t-i))),h=M(v[r+1],b(u,1/(i-o)+2/(i-t))),l=[n(e-i)*(e-o)/n(t-i)/(t-o),n(e-t)*n(e-i)/n(t-o)/n(i-o),n(e-t)*(e-o)/n(i-t)/(i-o),(e-t)*n(e-i)*(e-o)/n(t-i)/(t-o),(e-i)*n(e-t)*(e-o)/n(t-i)/(i-o)],x(x(x(x(b(a,l[0]),b(s,l[1])),b(u,l[2])),b(f,l[3])),b(h,l[4]))},numeric.Dopri.prototype.at=function(e){var r,n,t,i=Math.floor;if("number"!=typeof e){var o=e.length,a=Array(o);for(r=o-1;r!==-1;--r)a[r]=this.at(e[r]);return a}var u=this.x;for(r=0,n=u.length-1;n-r>1;)t=i(.5*(r+n)),u[t]<=e?r=t:n=t;return this._at(e,r)},numeric.dopri=function(e,r,n,t,i,o,a){"undefined"==typeof i&&(i=1e-6),"undefined"==typeof o&&(o=1e3);var u,s,c,f,h,l,m,d,p,v,y,g,x,b=[e],M=[n],w=[t(e,n)],_=[],C=.2,k=[.075,.225],A=[44/45,-56/15,32/9],j=[19372/6561,-25360/2187,64448/6561,-212/729],S=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],T=[35/384,0,500/1113,125/192,-2187/6784,11/84],P=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],O=[.2,.3,.8,8/9,1,1],N=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],q=0,F=(r-e)/10,B=0,V=numeric.add,G=numeric.mul,z=(Math.max,Math.min),L=Math.abs,D=numeric.norminf,R=Math.pow,H=numeric.any,I=numeric.lt,U=numeric.and,E=(numeric.sub,new numeric.Dopri(b,M,w,_,(-1),""));for("function"==typeof a&&(y=a(e,n));e<r&&B<o;)if(++B,e+F>r&&(F=r-e),u=t(e+O[0]*F,V(n,G(C*F,w[q]))),s=t(e+O[1]*F,V(V(n,G(k[0]*F,w[q])),G(k[1]*F,u))),c=t(e+O[2]*F,V(V(V(n,G(A[0]*F,w[q])),G(A[1]*F,u)),G(A[2]*F,s))),f=t(e+O[3]*F,V(V(V(V(n,G(j[0]*F,w[q])),G(j[1]*F,u)),G(j[2]*F,s)),G(j[3]*F,c))),h=t(e+O[4]*F,V(V(V(V(V(n,G(S[0]*F,w[q])),G(S[1]*F,u)),G(S[2]*F,s)),G(S[3]*F,c)),G(S[4]*F,f))),p=V(V(V(V(V(n,G(w[q],F*T[0])),G(s,F*T[2])),G(c,F*T[3])),G(f,F*T[4])),G(h,F*T[5])),l=t(e+F,p),m=V(V(V(V(V(G(w[q],F*N[0]),G(s,F*N[2])),G(c,F*N[3])),G(f,F*N[4])),G(h,F*N[5])),G(l,F*N[6])),v="number"==typeof m?L(m):D(m),v>i){if(F=.2*F*R(i/v,.25),e+F===e){E.msg="Step size became too small";break}}else{if(_[q]=V(V(V(V(V(V(n,G(w[q],F*P[0])),G(s,F*P[2])),G(c,F*P[3])),G(f,F*P[4])),G(h,F*P[5])),G(l,F*P[6])),++q,b[q]=e+F,M[q]=p,w[q]=l,"function"==typeof a){var X,Q,Y=e,Z=e+.5*F;if(g=a(Z,_[q-1]),x=U(I(y,0),I(0,g)),H(x)||(Y=Z,Z=e+F,y=g,g=a(Z,p),x=U(I(y,0),I(0,g))),H(x)){for(var W,$,J=0,K=1,ee=1;;){if("number"==typeof y)Q=(ee*g*Y-K*y*Z)/(ee*g-K*y);else for(Q=Z,d=y.length-1;d!==-1;--d)y[d]<0&&g[d]>0&&(Q=z(Q,(ee*g[d]*Y-K*y[d]*Z)/(ee*g[d]-K*y[d])));if(Q<=Y||Q>=Z)break;X=E._at(Q,q-1),$=a(Q,X),W=U(I(y,0),I(0,$)),H(W)?(Z=Q,g=$,x=W,ee=1,J===-1?K*=.5:K=1,J=-1):(Y=Q,y=$,K=1,1===J?ee*=.5:ee=1,J=1)}return p=E._at(.5*(e+Q),q-1),E.f[q]=t(Q,X),E.x[q]=Q,E.y[q]=X,E.ymid[q-1]=p,E.events=x,E.iterations=B,E}}e+=F,n=p,y=g,F=z(.8*F*R(i/v,.25),4*F)}return E.iterations=B,E},numeric.LU=function(e,r){r=r||!1;var n,t,i,o,a,u,s,c,f,h=Math.abs,l=e.length,m=l-1,d=new Array(l);for(r||(e=numeric.clone(e)),i=0;i<l;++i){for(s=i,u=e[i],f=h(u[i]),t=i+1;t<l;++t)o=h(e[t][i]),f<o&&(f=o,s=t);for(d[i]=s,s!=i&&(e[i]=e[s],e[s]=u,u=e[i]),a=u[i],n=i+1;n<l;++n)e[n][i]/=a;for(n=i+1;n<l;++n){for(c=e[n],t=i+1;t<m;++t)c[t]-=c[i]*u[t],++t,c[t]-=c[i]*u[t];t===m&&(c[t]-=c[i]*u[t])}}return{LU:e,P:d}},numeric.LUsolve=function(e,r){var n,t,i,o,a,u=e.LU,s=u.length,c=numeric.clone(r),f=e.P;for(n=s-1;n!==-1;--n)c[n]=r[n];for(n=0;n<s;++n)for(i=f[n],f[n]!==n&&(a=c[n],c[n]=c[i],c[i]=a),o=u[n],t=0;t<n;++t)c[n]-=c[t]*o[t];for(n=s-1;n>=0;--n){for(o=u[n],t=n+1;t<s;++t)c[n]-=c[t]*o[t];c[n]/=o[n]}return c},numeric.solve=function(e,r,n){return numeric.LUsolve(numeric.LU(e,n),r)},numeric.echelonize=function(e){var r,n,t,i,o,a,u,s,c=numeric.dim(e),f=c[0],h=c[1],l=numeric.identity(f),m=Array(f),d=Math.abs,p=numeric.diveq;for(e=numeric.clone(e),r=0;r<f;++r){for(t=0,o=e[r],a=l[r],n=1;n<h;++n)d(o[t])<d(o[n])&&(t=n);for(m[r]=t,p(a,o[t]),p(o,o[t]),n=0;n<f;++n)if(n!==r){for(u=e[n],s=u[t],i=h-1;i!==-1;--i)u[i]-=o[i]*s;for(u=l[n],i=f-1;i!==-1;--i)u[i]-=a[i]*s}}return{I:l,A:e,P:m}},numeric.__solveLP=function(e,r,n,t,i,o,a){var u,s,c,f,h=numeric.sum,l=(numeric.log,numeric.mul),m=numeric.sub,d=numeric.dot,p=numeric.div,v=numeric.add,y=e.length,g=n.length,x=!1,b=0,M=1,w=(numeric.transpose(r),numeric.svd,numeric.transpose),_=(numeric.leq,Math.sqrt),C=Math.abs,k=(numeric.muleq,numeric.norminf,numeric.any,Math.min),A=numeric.all,j=numeric.gt,S=Array(y),T=Array(g),P=(numeric.rep([g],1),numeric.solve),O=m(n,d(r,o)),N=d(e,e);for(c=b;c<i;++c){var q,F;for(q=g-1;q!==-1;--q)T[q]=p(r[q],O[q]);var B=w(T);for(q=y-1;q!==-1;--q)S[q]=h(B[q]);M=.25*C(N/d(e,S));var V=100*_(N/d(S,S));for((!isFinite(M)||M>V)&&(M=V),f=v(e,l(M,S)),s=d(B,T),q=y-1;q!==-1;--q)s[q][q]+=1;F=P(s,p(f,M),!0);var G=p(O,d(r,F)),z=1;for(q=g-1;q!==-1;--q)G[q]<0&&(z=k(z,-.999*G[q]));if(u=m(o,l(F,z)),O=m(n,d(r,u)),!A(j(O,0)))return{solution:o,message:"",iterations:c};if(o=u,M<t)return{solution:u,message:"",iterations:c};if(a){var L=d(e,f),D=d(r,f);for(x=!0,q=g-1;q!==-1;--q)if(L*D[q]<0){x=!1;break}}else x=!(o[y-1]>=0);if(x)return{solution:u,message:"Unbounded",iterations:c}}return{solution:o,message:"maximum iteration count exceeded",iterations:c}},numeric._solveLP=function(e,r,n,t,i){var o,a=e.length,u=n.length,s=(numeric.sum,numeric.log,numeric.mul,numeric.sub),c=numeric.dot,f=(numeric.div,numeric.add,numeric.rep([a],0).concat([1])),h=numeric.rep([u,1],-1),l=numeric.blockMatrix([[r,h]]),m=n,o=numeric.rep([a],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),d=numeric.__solveLP(f,l,m,t,i,o,!1),p=numeric.clone(d.solution);p.length=a;var v=numeric.inf(s(n,c(r,p)));if(v<0)return{solution:NaN,message:"Infeasible",iterations:d.iterations};var y=numeric.__solveLP(e,r,n,t,i-d.iterations,p,!0);return y.iterations+=d.iterations,y},numeric.solveLP=function(e,r,n,t,i,o,a){if("undefined"==typeof a&&(a=1e3),"undefined"==typeof o&&(o=numeric.epsilon),"undefined"==typeof t)return numeric._solveLP(e,r,n,o,a);var u,s=t.length,c=t[0].length,f=r.length,h=numeric.echelonize(t),l=numeric.rep([c],0),m=h.P,d=[];for(u=m.length-1;u!==-1;--u)l[m[u]]=1;for(u=c-1;u!==-1;--u)0===l[u]&&d.push(u);var p=numeric.getRange,v=numeric.linspace(0,s-1),y=numeric.linspace(0,f-1),g=p(t,v,d),x=p(r,y,m),b=p(r,y,d),M=numeric.dot,w=numeric.sub,_=M(x,h.I),C=w(b,M(_,g)),k=w(n,M(_,i)),A=Array(m.length),j=Array(d.length);for(u=m.length-1;u!==-1;--u)A[u]=e[m[u]];for(u=d.length-1;u!==-1;--u)j[u]=e[d[u]];var S=w(j,M(A,M(h.I,g))),T=numeric._solveLP(S,C,k,o,a),P=T.solution;if(P!==P)return T;var O=M(h.I,w(i,M(g,P))),N=Array(e.length);for(u=m.length-1;u!==-1;--u)N[m[u]]=O[u];for(u=d.length-1;u!==-1;--u)N[d[u]]=P[u];return{solution:N,message:T.message,iterations:T.iterations}},numeric.MPStoLP=function(e){function r(r){throw new Error("MPStoLP: "+r+"\nLine "+n+": "+e[n]+"\nCurrent state: "+u[a]+"\n")}e instanceof String&&e.split("\n");var n,t,i,o,a=0,u=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],s=e.length,c=0,f={},h=[],l=0,m={},d=0,p=[],v=[],y=[];for(n=0;n<s;++n){i=e[n];var g=i.match(/\S*/g),x=[];for(t=0;t<g.length;++t)""!==g[t]&&x.push(g[t]);if(0!==x.length){for(t=0;t<u.length&&i.substr(0,u[t].length)!==u[t];++t);if(t<u.length){if(a=t,1===t&&(o=x[1]),6===t)return{name:o,c:p,A:numeric.transpose(v),b:y,rows:f,vars:m}}else switch(a){case 0:case 1:r("Unexpected line");case 2:switch(x[0]){case"N":0===c?c=x[1]:r("Two or more N rows");break;case"L":f[x[1]]=l,h[l]=1,y[l]=0,++l;break;case"G":f[x[1]]=l,h[l]=-1,y[l]=0,++l;break;case"E":f[x[1]]=l,h[l]=0,y[l]=0,++l;break;default:r("Parse error "+numeric.prettyPrint(x))}break;case 3:m.hasOwnProperty(x[0])||(m[x[0]]=d,p[d]=0,v[d]=numeric.rep([l],0),++d);var b=m[x[0]];for(t=1;t<x.length;t+=2)if(x[t]!==c){var M=f[x[t]];v[b][M]=(h[M]<0?-1:1)*parseFloat(x[t+1])}else p[b]=parseFloat(x[t+1]);break;case 4:for(t=1;t<x.length;t+=2)y[f[x[t]]]=(h[f[x[t]]]<0?-1:1)*parseFloat(x[t+1]);break;case 5:break;case 6:r("Internal error")}}}r("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,r,n,t,i,o,a){function u(e){var r,t,i=this,o=e.length,a=0,u=i.i=i.j=i.m=0;for(i.S=[],i.c=[],o||(e=[o++]);a<n;)i.S[a]=a++;for(a=0;a<n;a++)r=i.S[a],u=f(u+r+e[a%o]),t=i.S[u],i.S[a]=t,i.S[u]=r;i.g=function(e){var r=i.S,t=f(i.i+1),o=r[t],a=f(i.j+o),u=r[a];r[t]=u,r[a]=o;for(var s=r[f(o+u)];--e;)t=f(t+1),o=r[t],a=f(a+o),u=r[a],r[t]=u,r[a]=o,s=s*n+r[f(o+u)];return i.i=t,i.j=a,s},i.g(n)}function s(e,r,n,t,i){if(n=[],i=typeof e,r&&"object"==i)for(t in e)if(t.indexOf("S")<5)try{n.push(s(e[t],r-1))}catch(e){}return n.length?n:e+("string"!=i?"\0":"")}function c(e,r,n,t){for(e+="",n=0,t=0;t<e.length;t++)r[f(t)]=f((n^=19*r[f(t)])+e.charCodeAt(t));e="";for(t in r)e+=String.fromCharCode(r[t]);return e}function f(e){return e&n-1}r.seedrandom=function(f,h){var l,m=[];return f=c(s(h?[f,e]:arguments.length?f:[(new Date).getTime(),e,window],3),m),l=new u(m),c(l.S,e),r.random=function(){for(var e=l.g(t),r=a,u=0;e<i;)e=(e+u)*n,r*=n,u=l.g(1);for(;e>=o;)e/=2,r/=2,u>>>=1;return(e+u)/r},f},a=r.pow(n,t),i=r.pow(2,i),o=2*i,c(r.random(),e)}([],numeric.seedrandom,256,6,52),function(e){function r(e){if("object"!=typeof e)return e;var n,t=[],i=e.length;for(n=0;n<i;n++)t[n+1]=r(e[n]);return t}function n(e){if("object"!=typeof e)return e;var r,t=[],i=e.length;for(r=1;r<i;r++)t[r-1]=n(e[r]);return t}function t(e,r,n){var t,i,o,a,u;for(o=1;o<=n;o+=1){for(e[o][o]=1/e[o][o],u=-e[o][o],t=1;t<o;t+=1)e[t][o]=u*e[t][o];if(a=o+1,n<a)break;for(i=a;i<=n;i+=1)for(u=e[o][i],e[o][i]=0,t=1;t<=o;t+=1)e[t][i]=e[t][i]+u*e[t][o]}}function i(e,r,n,t){var i,o,a,u;for(o=1;o<=n;o+=1){for(u=0,i=1;i<o;i+=1)u+=e[i][o]*t[i];t[o]=(t[o]-u)/e[o][o]}for(a=1;a<=n;a+=1)for(o=n+1-a,t[o]=t[o]/e[o][o],u=-t[o],i=1;i<o;i+=1)t[i]=t[i]+u*e[i][o]}function o(e,r,n,t){var i,o,a,u,s,c;for(o=1;o<=n;o+=1){if(t[1]=o,c=0,a=o-1,a<1){if(c=e[o][o]-c,c<=0)break;e[o][o]=Math.sqrt(c)}else{for(u=1;u<=a;u+=1){for(s=e[u][o],i=1;i<u;i+=1)s-=e[i][o]*e[i][u];s/=e[u][u],e[u][o]=s,c+=s*s}if(c=e[o][o]-c,c<=0)break;e[o][o]=Math.sqrt(c)}t[1]=0}}function a(e,r,n,a,u,s,c,f,h,l,m,d,p,v,y,g){function x(){for(v[1]=v[1]+1,A=q,C=1;C<=l;C+=1){for(A+=1,L=-f[C],k=1;k<=a;k+=1)L+=c[k][C]*u[k];if(Math.abs(L)<Q&&(L=0),C>m)y[A]=L;else if(y[A]=-Math.abs(L),L>0){for(k=1;k<=a;k+=1)c[k][C]=-c[k][C];f[C]=-f[C]}}for(C=1;C<=p;C+=1)y[q+d[C]]=0;for(B=0,z=0,C=1;C<=l;C+=1)y[q+C]<z*y[G+C]&&(B=C,z=y[q+C]/y[G+C]);return 0===B?999:0}function b(){for(C=1;C<=a;C+=1){for(L=0,k=1;k<=a;k+=1)L+=e[k][C]*c[k][B];y[C]=L}for(j=P,C=1;C<=a;C+=1)y[j+C]=0;for(k=p+1;k<=a;k+=1)for(C=1;C<=a;C+=1)y[j+C]=y[j+C]+e[C][k]*y[k];for(E=!0,C=p;C>=1;C-=1){for(L=y[C],A=N+C*(C+3)/2,j=A-C,k=C+1;k<=p;k+=1)L-=y[A]*y[O+k],A+=k;if(L/=y[j],y[O+C]=L,d[C]<m)break;if(L<0)break;E=!1,T=C}if(!E)for(D=y[F+T]/y[O+T],C=1;C<=p&&!(d[C]<m)&&!(y[O+C]<0);C+=1)z=y[F+C]/y[O+C],z<D&&(D=z,T=C);for(L=0,C=P+1;C<=P+a;C+=1)L+=y[C]*y[C];if(Math.abs(L)<=Q){if(E)return g[1]=1,999;for(C=1;C<=p;C+=1)y[F+C]=y[F+C]-D*y[O+C];return y[F+p+1]=y[F+p+1]+D,700}for(L=0,C=1;C<=a;C+=1)L+=y[P+C]*c[C][B];for(R=-y[q+B]/L,X=!0,E||D<R&&(R=D,X=!1),C=1;C<=a;C+=1)u[C]=u[C]+R*y[P+C],Math.abs(u[C])<Q&&(u[C]=0);for(s[1]=s[1]+R*L*(R/2+y[F+p+1]),C=1;C<=p;C+=1)y[F+C]=y[F+C]-R*y[O+C];if(y[F+p+1]=y[F+p+1]+R,!X){for(L=-f[B],k=1;k<=a;k+=1)L+=u[k]*c[k][B];if(B>m)y[q+B]=L;else if(y[q+B]=-Math.abs(L),L>0){for(k=1;k<=a;k+=1)c[k][B]=-c[k][B];f[B]=-f[B]}return 700}for(p+=1,d[p]=B,A=N+(p-1)*p/2+1,C=1;C<=p-1;C+=1)y[A]=y[C],A+=1;if(p===a)y[A]=y[a];else{for(C=a;C>=p+1&&0!==y[C]&&(H=Math.max(Math.abs(y[C-1]),Math.abs(y[C])),I=Math.min(Math.abs(y[C-1]),Math.abs(y[C])),z=y[C-1]>=0?Math.abs(H*Math.sqrt(1+I*I/(H*H))):-Math.abs(H*Math.sqrt(1+I*I/(H*H))),H=y[C-1]/z,I=y[C]/z,1!==H);C-=1)if(0===H)for(y[C-1]=I*z,k=1;k<=a;k+=1)z=e[k][C-1],e[k][C-1]=e[k][C],e[k][C]=z;else for(y[C-1]=z,U=I/(1+H),k=1;k<=a;k+=1)z=H*e[k][C-1]+I*e[k][C],e[k][C]=U*(e[k][C-1]+z)-e[k][C],e[k][C-1]=z;y[A]=y[p]}return 0}function M(){if(A=N+T*(T+1)/2+1,j=A+T,0===y[j])return 798;if(H=Math.max(Math.abs(y[j-1]),Math.abs(y[j])),I=Math.min(Math.abs(y[j-1]),Math.abs(y[j])),z=y[j-1]>=0?Math.abs(H*Math.sqrt(1+I*I/(H*H))):-Math.abs(H*Math.sqrt(1+I*I/(H*H))),H=y[j-1]/z,I=y[j]/z,1===H)return 798;if(0===H){for(C=T+1;C<=p;C+=1)z=y[j-1],y[j-1]=y[j],y[j]=z,j+=C;for(C=1;C<=a;C+=1)z=e[C][T],e[C][T]=e[C][T+1],e[C][T+1]=z}else{for(U=I/(1+H),C=T+1;C<=p;C+=1)z=H*y[j-1]+I*y[j],y[j]=U*(y[j-1]+z)-y[j],y[j-1]=z,j+=C;for(C=1;C<=a;C+=1)z=H*e[C][T]+I*e[C][T+1],e[C][T+1]=U*(e[C][T]+z)-e[C][T+1],e[C][T]=z}return 0}function w(){for(j=A-T,C=1;C<=T;C+=1)y[j]=y[A],A+=1,j+=1;return y[F+T]=y[F+T+1],d[T]=d[T+1],T+=1,T<p?797:0}function _(){return y[F+p]=y[F+p+1],y[F+p+1]=0,d[p]=0,p-=1,v[2]=v[2]+1,0}var C,k,A,j,S,T,P,O,N,q,F,B,V,G,z,L,D,R,H,I,U,E,X,Q,Y,Z,W;V=Math.min(a,l),A=2*a+V*(V+5)/2+2*l+1,Q=1e-60;do Q+=Q,
Y=1+.1*Q,Z=1+.2*Q;while(Y<=1||Z<=1);for(C=1;C<=a;C+=1)y[C]=r[C];for(C=a+1;C<=A;C+=1)y[C]=0;for(C=1;C<=l;C+=1)d[C]=0;if(S=[],0===g[1]){if(o(e,n,a,S),0!==S[1])return void(g[1]=2);i(e,n,a,r),t(e,n,a)}else{for(k=1;k<=a;k+=1)for(u[k]=0,C=1;C<=k;C+=1)u[k]=u[k]+e[C][k]*r[C];for(k=1;k<=a;k+=1)for(r[k]=0,C=k;C<=a;C+=1)r[k]=r[k]+e[k][C]*u[C]}for(s[1]=0,k=1;k<=a;k+=1)for(u[k]=r[k],s[1]=s[1]+y[k]*u[k],y[k]=0,C=k+1;C<=a;C+=1)e[C][k]=0;for(s[1]=-s[1]/2,g[1]=0,P=a,O=P+a,F=O+V,N=F+V+1,q=N+V*(V+1)/2,G=q+l,C=1;C<=l;C+=1){for(L=0,k=1;k<=a;k+=1)L+=c[k][C]*c[k][C];y[G+C]=Math.sqrt(L)}for(p=0,v[1]=0,v[2]=0,W=0;;){if(W=x(),999===W)return;for(;;){if(W=b(),0===W)break;if(999===W)return;if(700===W)if(T===p)_();else{for(;;)if(M(),W=w(),797!==W)break;_()}}}}function u(e,t,i,o,u,s){e=r(e),t=r(t),i=r(i);var c,f,h,l,m,d,p=[],v=[],y=[],g=[],x=[];if(u=u||0,s=s?r(s):[void 0,0],o=o?r(o):[],f=e.length-1,h=i[1].length-1,!o)for(c=1;c<=h;c+=1)o[c]=0;for(c=1;c<=h;c+=1)v[c]=0;for(l=0,m=Math.min(f,h),c=1;c<=f;c+=1)y[c]=0;for(p[1]=0,c=1;c<=2*f+m*(m+5)/2+2*h+1;c+=1)g[c]=0;for(c=1;c<=2;c+=1)x[c]=0;return a(e,t,f,f,y,p,i,o,f,h,u,v,l,x,g,s),d="",1===s[1]&&(d="constraints are inconsistent, no solution!"),2===s[1]&&(d="matrix D in quadratic function is not positive definite!"),{solution:n(y),value:n(p),unconstrained_solution:n(t),iterations:n(x),iact:n(v),message:d}}e.solveQP=u}(numeric),numeric.svd=function(e){function r(e,r){return e=Math.abs(e),r=Math.abs(r),e>r?e*Math.sqrt(1+r*r/e/e):0==r?e:r*Math.sqrt(1+e*e/r/r)}var n,t=numeric.epsilon,i=1e-64/t,o=50,a=0,u=0,s=0,c=0,f=0,h=numeric.clone(e),l=h.length,m=h[0].length;if(l<m)throw"Need more rows than columns";var d=new Array(m),p=new Array(m);for(u=0;u<m;u++)d[u]=p[u]=0;var v=numeric.rep([m,m],0),y=0,g=0,x=0,b=0,M=0,w=0,_=0;for(u=0;u<m;u++){for(d[u]=g,_=0,f=u+1,s=u;s<l;s++)_+=h[s][u]*h[s][u];if(_<=i)g=0;else for(y=h[u][u],g=Math.sqrt(_),y>=0&&(g=-g),x=y*g-_,h[u][u]=y-g,s=f;s<m;s++){for(_=0,c=u;c<l;c++)_+=h[c][u]*h[c][s];for(y=_/x,c=u;c<l;c++)h[c][s]+=y*h[c][u]}for(p[u]=g,_=0,s=f;s<m;s++)_+=h[u][s]*h[u][s];if(_<=i)g=0;else{for(y=h[u][u+1],g=Math.sqrt(_),y>=0&&(g=-g),x=y*g-_,h[u][u+1]=y-g,s=f;s<m;s++)d[s]=h[u][s]/x;for(s=f;s<l;s++){for(_=0,c=f;c<m;c++)_+=h[s][c]*h[u][c];for(c=f;c<m;c++)h[s][c]+=_*d[c]}}M=Math.abs(p[u])+Math.abs(d[u]),M>b&&(b=M)}for(u=m-1;u!=-1;u+=-1){if(0!=g){for(x=g*h[u][u+1],s=f;s<m;s++)v[s][u]=h[u][s]/x;for(s=f;s<m;s++){for(_=0,c=f;c<m;c++)_+=h[u][c]*v[c][s];for(c=f;c<m;c++)v[c][s]+=_*v[c][u]}}for(s=f;s<m;s++)v[u][s]=0,v[s][u]=0;v[u][u]=1,g=d[u],f=u}for(u=m-1;u!=-1;u+=-1){for(f=u+1,g=p[u],s=f;s<m;s++)h[u][s]=0;if(0!=g){for(x=h[u][u]*g,s=f;s<m;s++){for(_=0,c=f;c<l;c++)_+=h[c][u]*h[c][s];for(y=_/x,c=u;c<l;c++)h[c][s]+=y*h[c][u]}for(s=u;s<l;s++)h[s][u]=h[s][u]/g}else for(s=u;s<l;s++)h[s][u]=0;h[u][u]+=1}for(t*=b,c=m-1;c!=-1;c+=-1)for(var C=0;C<o;C++){var k=!1;for(f=c;f!=-1;f+=-1){if(Math.abs(d[f])<=t){k=!0;break}if(Math.abs(p[f-1])<=t)break}if(!k){a=0,_=1;var A=f-1;for(u=f;u<c+1&&(y=_*d[u],d[u]=a*d[u],!(Math.abs(y)<=t));u++)for(g=p[u],x=r(y,g),p[u]=x,a=g/x,_=-y/x,s=0;s<l;s++)M=h[s][A],w=h[s][u],h[s][A]=M*a+w*_,h[s][u]=-M*_+w*a}if(w=p[c],f==c){if(w<0)for(p[c]=-w,s=0;s<m;s++)v[s][c]=-v[s][c];break}if(C>=o-1)throw"Error: no convergence.";for(b=p[f],M=p[c-1],g=d[c-1],x=d[c],y=((M-w)*(M+w)+(g-x)*(g+x))/(2*x*M),g=r(y,1),y=y<0?((b-w)*(b+w)+x*(M/(y-g)-x))/b:((b-w)*(b+w)+x*(M/(y+g)-x))/b,a=1,_=1,u=f+1;u<c+1;u++){for(g=d[u],M=p[u],x=_*g,g=a*g,w=r(y,x),d[u-1]=w,a=y/w,_=x/w,y=b*a+g*_,g=-b*_+g*a,x=M*_,M*=a,s=0;s<m;s++)b=v[s][u-1],w=v[s][u],v[s][u-1]=b*a+w*_,v[s][u]=-b*_+w*a;for(w=r(y,x),p[u-1]=w,a=y/w,_=x/w,y=a*g+_*M,b=-_*g+a*M,s=0;s<l;s++)M=h[s][u-1],w=h[s][u],h[s][u-1]=M*a+w*_,h[s][u]=-M*_+w*a}d[f]=0,d[c]=y,p[c]=b}for(u=0;u<p.length;u++)p[u]<t&&(p[u]=0);for(u=0;u<m;u++)for(s=u-1;s>=0;s--)if(p[s]<p[u]){for(a=p[s],p[s]=p[u],p[u]=a,c=0;c<h.length;c++)n=h[c][u],h[c][u]=h[c][s],h[c][s]=n;for(c=0;c<v.length;c++)n=v[c][u],v[c][u]=v[c][s],v[c][s]=n;u=s}return{U:h,S:p,V:v}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],36:[function(e,r,n){function t(e,r,n,t,i){return a(0,e,r,n,t,i)}function i(e,r,n,t,i){var o,u,s,c;return 0==r?(o=a(1,e,1,n,t,i),u=a(-1,e,-1,n,t,i),s=o+u):r>0?(c=1==r?1:0,o=a(1,e,r-1,n,t,i),u=a(-1,e,-r+1,n,t,i),s=o*Math.sqrt(1+c)-u*(1-c)):(c=r==-1?1:0,o=a(1,e,r+1,n,t,i),u=a(-1,e,-r-1,n,t,i),s=o*(1-c)+u*Math.sqrt(1+c)),s}function o(e,r,n,t,i){var o,u,s;return 0==r?console.error("should not be called"):r>0?(o=a(1,e,r+1,n,t,i),u=a(-1,e,-r-1,n,t,i),s=o+u):(o=a(1,e,r-1,n,t,i),u=a(-1,e,-r+1,n,t,i),s=o-u),s}function a(e,r,n,t,i,o){var a,u,s,c;return a=i[e+1][2],u=i[e+1][0],s=i[e+1][1],c=t==-r?a*o[n+r-1][0]+u*o[n+r-1][2*r-2]:t==r?a*o[n+r-1][2*r-2]-u*o[n+r-1][0]:s*o[n+r-1][t+r-1]}var u=e("numeric"),s=function(e,r,n,t){var i,o=r.length,a=(e+1)*(e+1),s=[,];a>o&&console.log("The SHT degree is too high for the number of data points"),0==n&&(r=h(r));for(var c=0;c<r.length;c++)s[c]=r[c][2];Y_N=m(e,r),i=0==t?u.mul(1/o,Y_N):y(u.transpose(Y_N));var f=u.dotMV(i,s);return f},c=function(e,r){for(var n=r,t=Math.sqrt(e.length)-1,i=m(t,r),o=u.dotVM(e,i),a=0;a<r.length;a++)n[a][2]=o[a];return n},f=function(e){for(var r=0;r<e.length;r++)console.log(e[r])},h=function(e,r){for(var n,t,i,o=new Array(e.length),a=0;a<e.length;a++)n=Math.atan2(e[a][1],e[a][0]),t=Math.atan2(e[a][2],Math.sqrt(e[a][0]*e[a][0]+e[a][1]*e[a][1])),1==r?o[a]=[n,t]:(i=Math.sqrt(e[a][0]*e[a][0]+e[a][1]*e[a][1]+e[a][2]*e[a][2]),o[a]=[n,t,i]);return o},l=function(e){for(var r,n,t,i=new Array(e.length),o=0;o<e.length;o++)r=Math.cos(e[o][0])*Math.cos(e[o][1]),n=Math.sin(e[o][0])*Math.cos(e[o][1]),t=Math.sin(e[o][1]),2==e[0].length?i[o]=[r,n,t]:3==e[0].length&&(i[o]=[e[o][2]*r,e[o][2]*n,e[o][2]*t]);return i},m=function(e,r){for(var n=new Array(r.length),t=new Array(r.length),i=0;i<r.length;i++)n[i]=r[i][0],t[i]=r[i][1];for(var o,a,s,c,f,h=new Array(2*e+1),l=(n.length,(e+1)*(e+1)),m=0,v=0,y=u.sin(t),g=0,x=new Array(l),i=0;i<2*e+1;i++)h[i]=d(i);for(var b=0;b<e+1;b++){if(0==b){var M=new Array(n.length);M.fill(1),x[b]=M,g=1}else{o=p(b,y,m,v),a=Math.sqrt(2*b+1);for(var w=0;w<b+1;w++)0==w?x[g+b]=u.mul(a,o[w]):(s=a*Math.sqrt(2*h[b-w]/h[b+w]),c=u.cos(u.mul(w,n)),f=u.sin(u.mul(w,n)),x[g+b-w]=u.mul(s,u.mul(o[w],f)),x[g+b+w]=u.mul(s,u.mul(o[w],c)));g=g+2*b+1}v=m,m=o}return x},d=function(e){return 0===e?1:e*d(e-1)},p=function(e,r,n,t){var i=new Array(e+1);switch(e){case 1:var o=u.mul(r,r),a=r,s=u.sqrt(u.sub(1,o));i[0]=a,i[1]=s;break;case 2:var o=u.mul(r,r),c=u.mul(3,o);c=u.sub(c,1),c=u.div(c,2);var f=u.sub(1,o);f=u.sqrt(f),f=u.mul(3,f),f=u.mul(f,r);var h=u.sub(1,o);h=u.mul(3,h),i[0]=c,i[1]=f,i[2]=h;break;default:var o=u.mul(r,r),l=u.sub(1,o),m=2*e-1,d=1;if(m%2==0)for(var p=1;p<m/2+1;p++)d=2*d*p;else for(var p=1;p<(m+1)/2+1;p++)d*=2*p-1;i[e]=u.mul(d,u.pow(l,e/2)),i[e-1]=u.mul(2*e-1,u.mul(r,n[e-1]));for(var v=0;v<e-1;v++){var y=u.mul(2*e-1,u.mul(r,n[v])),g=u.mul(e+v-1,t[v]);i[v]=u.div(u.sub(y,g),e-v)}}return i},v=function(e){for(var r=u.svd(e),n=r.S[0],t=r.U,i=r.S,o=r.V,a=e.length,s=e[0].length,c=Math.max(a,s)*u.epsilon*n,f=i.length,h=new Array(f),l=f-1;l!==-1;l--)i[l]>c?h[l]=1/i[l]:h[l]=0;return u.dot(u.dot(o,u.diag(h)),u.transpose(t))},y=function(e){var r=u.transpose(e);return u.dot(u.inv(u.dot(r,e)),r)},g=function(e,r){var n=(r+1)*(r+1),a=u.rep([n,n],0);a[0][0]=1;var s=u.rep([3,3],0);s[0][0]=e[1][1],s[0][1]=e[1][2],s[0][2]=e[1][0],s[1][0]=e[2][1],s[1][1]=e[2][2],s[1][2]=e[2][0],s[2][0]=e[0][1],s[2][1]=e[0][2],s[2][2]=e[0][0],a=u.setBlock(a,[1,1],[3,3],s);for(var c=s,f=3,h=2;h<r+1;h++){for(var l=u.rep([2*h+1,2*h+1],0),m=-h;m<h+1;m++)for(var d=-h;d<h+1;d++){var p,v,y,g,x;p=0==m?1:0,v=Math.abs(d)==h?2*h*(2*h-1):h*h-d*d,y=Math.sqrt((h*h-m*m)/v),g=Math.sqrt((1+p)*(h+Math.abs(m)-1)*(h+Math.abs(m))/v)*(1-2*p)*.5,x=Math.sqrt((h-Math.abs(m)-1)*(h-Math.abs(m))/v)*(1-p)*-.5,0!=y&&(y*=t(h,m,d,s,c)),0!=g&&(g*=i(h,m,d,s,c)),0!=x&&(x*=o(h,m,d,s,c)),l[m+h][d+h]=y+g+x}a=u.setBlock(a,[f+1,f+1],[f+2*h+1,f+2*h+1],l),c=l,f=f+2*h+1}return a},x=function(e,r,n){var t,i,o;t=0==n?[[1,0,0],[0,1,0],[0,0,1]]:[[1,0,0],[0,Math.cos(n),Math.sin(n)],[0,-Math.sin(n),Math.cos(n)]],i=0==r?[[1,0,0],[0,1,0],[0,0,1]]:[[Math.cos(r),0,-Math.sin(r)],[0,1,0],[Math.sin(r),0,Math.cos(r)]],o=0==e?[[1,0,0],[0,1,0],[0,0,1]]:[[Math.cos(e),Math.sin(e),0],[-Math.sin(e),Math.cos(e),0],[0,0,1]];var a=u.dotMMsmall(i,o);return a=u.dotMMsmall(t,a)};r.exports.forwardSHT=s,r.exports.inverseSHT=c,r.exports.print2Darray=f,r.exports.convertCart2Sph=h,r.exports.convertSph2Cart=l,r.exports.computeRealSH=m,r.exports.factorial=d,r.exports.recurseLegendrePoly=p,r.exports.pinv_svd=v,r.exports.pinv_direct=y,r.exports.getSHrotMtx=g,r.exports.yawPitchRoll2Rzyx=x},{numeric:35}]},{},[14])(14)});